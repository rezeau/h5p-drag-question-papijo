!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:o})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=t.curry=function(e){var t=e.length;return function n(){var o=Array.prototype.slice.call(arguments,0);return o.length>=t?e.apply(null,o):function(){var e=Array.prototype.slice.call(arguments,0);return n.apply(null,o.concat(e))}}},i=(t.compose=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(function(e,t){return function(){return e(t.apply(void 0,arguments))}})},t.forEach=o(function(e,t){t.forEach(e)}),t.map=o(function(e,t){return t.map(e)}),t.filter=o(function(e,t){return t.filter(e)})),r=(t.some=o(function(e,t){return t.some(e)}),t.contains=o(function(e,t){return-1!=t.indexOf(e)}));t.without=o(function(e,t){return i(function(t){return!r(t,e)},t)}),t.inverseBooleanString=function(e){return("true"!==e).toString()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createElement=t.toggleClass=t.toggleVisibility=t.show=t.hide=t.removeClass=t.addClass=t.classListContains=t.removeChild=t.querySelectorAll=t.nodeListToArray=t.querySelector=t.appendChild=t.toggleAttribute=t.attributeEquals=t.hasAttribute=t.removeAttribute=t.setAttribute=t.getAttribute=void 0;var o=n(0),i=t.getAttribute=(0,o.curry)(function(e,t){return t.getAttribute(e)}),r=t.setAttribute=(0,o.curry)(function(e,t,n){return n.setAttribute(e,t)}),s=(t.removeAttribute=(0,o.curry)(function(e,t){return t.removeAttribute(e)}),t.hasAttribute=(0,o.curry)(function(e,t){return t.hasAttribute(e)}),t.attributeEquals=(0,o.curry)(function(e,t,n){return n.getAttribute(e)===t}),t.toggleAttribute=(0,o.curry)(function(e,t){var n=i(e,t);r(e,(0,o.inverseBooleanString)(n),t)}),t.appendChild=(0,o.curry)(function(e,t){return e.appendChild(t)}),t.querySelector=(0,o.curry)(function(e,t){return t.querySelector(e)}),t.nodeListToArray=function(e){return Array.prototype.slice.call(e)}),a=(t.querySelectorAll=(0,o.curry)(function(e,t){return s(t.querySelectorAll(e))}),t.removeChild=(0,o.curry)(function(e,t){return e.removeChild(t)}),t.classListContains=(0,o.curry)(function(e,t){return t.classList.contains(e)}),t.addClass=(0,o.curry)(function(e,t){return t.classList.add(e)})),l=t.removeClass=(0,o.curry)(function(e,t){return t.classList.remove(e)}),u=t.hide=a("hidden"),c=t.show=l("hidden");t.toggleVisibility=(0,o.curry)(function(e,t){return(e?c:u)(t)}),t.toggleClass=(0,o.curry)(function(e,t,n){n.classList[t?"add":"remove"](e)}),t.createElement=function(e){var t=e.tag,n=e.id,o=e.classes,i=e.attributes,r=document.createElement(t);return n&&(r.id=n),o&&o.forEach(function(e){r.classList.add(e)}),i&&Object.keys(i).forEach(function(e){r.setAttribute(e,i[e])}),r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,null,[{key:"setElementOpacity",value:function(t,n){e.setOpacity(t,"borderColor",n),e.setOpacity(t,"boxShadow",n),e.setOpacity(t,"background",n)}},{key:"setOpacity",value:function(t,n,o){if("background"===n)return e.setOpacity(t,"backgroundColor",o),void e.setOpacity(t,"backgroundImage",o);function i(e,t){switch(e){case"borderColor":return{borderTopColor:t,borderRightColor:t,borderBottomColor:t,borderLeftColor:t};default:var n={};return n[e]=t,n}}o=void 0===o?1:o/100;var r=t.css(n),s=i(n,"");t.css(s);for(var a in s)break;var l=t.css(a);""!==l&&"none"!==l||(l=r),l=e.setAlphas(l,"rgba(",o),l=e.setAlphas(l,"rgb(",o),t.css(i(n,l))}},{key:"setAlphas",value:function(e,t,n){if(e){for(var o=e.indexOf(t);-1!==o;){var i=e.indexOf(")",o),r=e.substring(o+t.length,i).split(",");r[3]=void 0!==r[3]?parseFloat(r[3])*n:n,o=(e=e.substring(0,o)+"rgba("+r.join(",")+e.substring(i,e.length)).indexOf(t,i)}return e}}},{key:"elementToDraggable",value:function(e,t){for(var n=0;n<e.length;n++)if(e[n]){var o=e[n].findElement(t);if(o)return o.draggable=e[n],o}}},{key:"elementToDropZone",value:function(e,t){for(var n=0;n<e.length;n++)if(e[n].$dropZone.is(t))return e[n]}},{key:"positionToPercentage",value:function(e,t){return{top:100*parseInt(t.css("top"))/e.innerHeight()+"%",left:100*parseInt(t.css("left"))/e.innerWidth()+"%"}}},{key:"addHover",value:function(t,n){t.hover(function(){t.addClass("h5p-draggable-hover"),t.parent().hasClass("h5p-dragging")||e.setElementOpacity(t,n)},function(){t.parent().hasClass("h5p-dragging")||setTimeout(function(){t.removeClass("h5p-draggable-hover"),e.setElementOpacity(t,n)},1)}),e.setElementOpacity(t,n)}},{key:"strip",value:function(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""}}]),e}();t.default=i},function(e,t,n){"use strict";var o=c(n(4)),i=c(n(6)),r=c(n(7)),s=c(n(8)),a=c(n(2)),l=c(n(9)),u=c(n(10));function c(e){return e&&e.__esModule?e:{default:e}}var d=H5P.jQuery,h=0;function p(e,t,n){var o,i,r=this;h++,this.id=this.contentId=t,H5P.Question.call(r,"dragquestion"),this.options=d.extend(!0,{},{scoreShow:"Check",tryAgain:"Retry",showSolutionButton:"Show solution",grabbablePrefix:"Grabbable {num} of {total}.",grabbableSuffix:"Placed in dropzone {num}.",dropzonePrefix:"Dropzone {num} of {total}.",noDropzone:"No dropzone",tipLabel:"Show tip.",tipAvailable:"Tip available",correctAnswer:"Correct answer",wrongAnswer:"Wrong answer",feedbackHeader:"Feedback",scoreBarLabel:"You got :num out of :total points",scoreExplanationButtonLabel:"Show score explanation",displaySolutionDescription:"Task is updated to contain the solution.",noInput:"Please answer before viewing the solution",question:{settings:{questionTitle:"Drag and drop",showTitle:!0,size:{width:620,height:310}},task:{elements:[],dropZones:[]}},overallFeedback:[],behaviour:{enableRetry:!0,enableSolutionButton:!1,enableCheckButton:!0,preventResize:!1,singlePoint:!1,showSolutionsRequiresInput:!0,removeCorrectWrongStyles:!1,applyPenalties:!0,enableScoreExplanation:!0,dropZoneHighlighting:"dragging",autoAlignSpacing:2,showScorePoints:!0,showScoreInline:!1,keepCorrectAnswers:!1,randomizeDraggables:!1,resetSingleDraggables:!1}},e),this.options.behaviour.singlePoint&&(this.options.behaviour.enableScoreExplanation=!1),this.draggables=[],this.dropZones=[],this.answered=n&&void 0!==n.previousState&&void 0!==n.previousState.answers&&n.previousState.answers.length,this.hasSavedState=this.answered,this.blankIsCorrect=!0,this.backgroundOpacity=void 0===this.options.behaviour.backgroundOpacity||""===this.options.behaviour.backgroundOpacity?void 0:this.options.behaviour.backgroundOpacity,this.backgroundColor="rgba(255, 255, 255, 0)"===this.options.question.settings.backgroundColor?void 0:this.options.question.settings.backgroundColor,this.backgroundOpacityDropZones=void 0===this.options.behaviour.backgroundOpacityDropZones||""===this.options.behaviour.backgroundOpacityDropZones?void 0:this.options.behaviour.backgroundOpacityDropZones,this.overrideBorderColor="rgba(0, 0, 0, 0)"===this.options.behaviour.overrideBorderColor?void 0:this.options.behaviour.overrideBorderColor,this.dropZonesBackgroundColor=void 0===this.options.behaviour.dropZonesBackgroundColor?"rgb(245, 245, 245)":this.options.behaviour.dropZonesBackgroundColor,this.solutionViewed=!1,this.answerChecked=!1,this.scoreViewed=!1,this.maxScoreReached=!1,r.$noDropZone=d('<div class="h5p-dq-no-dz" role="button" style="display:none;"><span class="h5p-hidden-read">'+r.options.noDropzone+"</span></div>");var s=g(r.draggables,r.dropZones,r.$noDropZone[0]),c=function(e){for(var t=0;t<s.drop.elements.length;t++)s.drop.elements[t].setAttribute("aria-dropeffect",e)},p=[],f=this.options.question.task;for(this.correctDZs=[],o=0;o<f.dropZones.length;o++){p.push(!0);var b=f.dropZones[o].correctElements;for(i=0;i<b.length;i++){var v=b[i];void 0===this.correctDZs[v]&&(this.correctDZs[v]=[]),this.correctDZs[v].push(o)}void 0!==this.overrideBorderColor&&(f.dropZones[o].bordercolor=this.overrideBorderColor),f.dropZones[o].background=this.dropZonesBackgroundColor}this.weight=1;var m={prefix:r.options.grabbablePrefix.replace("{total}",f.elements.length),suffix:r.options.grabbableSuffix,correctAnswer:r.options.correctAnswer,wrongAnswer:r.options.wrongAnswer};for(o=0;o<f.elements.length;o++){var y=f.elements[o];if(void 0!==y.dropZones&&y.dropZones.length){void 0!==this.backgroundOpacity&&(y.backgroundOpacity=this.backgroundOpacity);var w=null;n&&void 0!==n.previousState&&void 0!==n.previousState.answers&&void 0!==n.previousState.answers[o]&&(w=n.previousState.answers[o]);var k=new u.default(y,o,w,m),x="dragging"===r.options.behaviour.dropZoneHighlighting;for(k.on("elementadd",function(e){s.drag.addElement(e.data)}),k.on("elementremove",function(e){s.drag.removeElement(e.data),"true"===e.data.getAttribute("aria-grabbed")&&(s.drag.firesEvent("select",e.data),e.data.removeAttribute("aria-grabbed"))}),k.on("focus",function(e){s.drag.setTabbable(e.data),e.data.focus()}),k.on("dragstart",function(e){x&&r.$container.addClass("h5p-dq-highlight-dz"),c(e.data)}),k.on("dragend",function(){x&&r.$container.removeClass("h5p-dq-highlight-dz"),c("none")}),k.on("interacted",function(){r.answered=!0,r.triggerXAPIScored(r.getScore(),r.getMaxScore(),"interacted")}),k.on("leavingDropZone",function(e){r.dropZones[e.data.dropZone].removeAlignable(e.data.$)}),this.draggables[o]=k,i=0;i<y.dropZones.length;i++)p[y.dropZones[i]]=!1}}this.numDropZonesWithoutElements=0;var E={prefix:r.options.dropzonePrefix.replace("{total}",f.dropZones.length),tipLabel:r.options.tipLabel,tipAvailable:r.options.tipAvailable};for(o=0;o<f.dropZones.length;o++){var $=f.dropZones[o];!0===p[o]&&(this.numDropZonesWithoutElements+=1),this.blankIsCorrect&&$.correctElements.length&&(this.blankIsCorrect=!1),void 0!==this.backgroundOpacityDropZones&&($.backgroundOpacity=this.backgroundOpacityDropZones),$.resetSingleDraggables=this.options.behaviour.resetSingleDraggables,$.autoAlign={enabled:$.autoAlign,spacing:r.options.behaviour.autoAlignSpacing,size:r.options.question.settings.size},this.dropZones[o]=new l.default($,o,E),this.dropZones[o].on("elementaligned",function(e){for(var t=e.data,n=0;n<r.draggables.length;n++){var o=r.draggables[n];if(o&&o.elements&&o.elements.length)for(var i=0;i<o.elements.length;i++){var s=o.elements[i];if(s&&s.$[0]===t[0])return void(s.position=a.default.positionToPercentage(r.$container,s.$))}}})}this.on("resize",r.resize,r),this.on("domChanged",function(e){r.contentId===e.data.contentId&&r.trigger("resize")}),this.on("enterFullScreen",function(){r.$container&&(r.$container.parents(".h5p-content").css("height","100%"),r.trigger("resize"))}),this.on("exitFullScreen",function(){r.$container&&(r.$container.parents(".h5p-content").css("height","auto"),r.trigger("resize"))})}p.prototype=Object.create(H5P.Question.prototype),p.prototype.constructor=p,p.prototype.registerDomElements=function(){var e=this;e.options.question.settings.showTitle&&(e.$introduction=d('<p class="h5p-dragquestion-introduction" id="dq-intro-'+h+'">'+e.options.question.settings.questionTitle+"</p>"),e.setIntroduction(e.$introduction));var t="";if(void 0!==this.options.question.settings.background&&(t+="h5p-dragquestion-has-no-background"),"always"===e.options.behaviour.dropZoneHighlighting&&(t&&(t+=" "),t+="h5p-dq-highlight-dz-always"),e.setContent(e.createQuestionContent(),{class:t}),!1!==H5P.canHasFullScreen&&this.options.behaviour.enableFullScreen){var n=function(){H5P.isFullscreen?H5P.exitFullScreen(e.$container):H5P.fullScreen(e.$container.parent().parent(),e)},o=d("<div/>",{class:"h5p-my-fullscreen-button-enter",title:this.options.localize.fullscreen,role:"button",tabindex:0,on:{click:n,keypress:function(e){13!==e.which&&32!==e.which||(n(),e.preventDefault())}},prependTo:this.$container.parent()});this.on("enterFullScreen",function(){o.attr("class","h5p-my-fullscreen-button-exit"),o.attr("title",this.options.localize.exitFullscreen)}),this.on("exitFullScreen",function(){o.attr("class","h5p-my-fullscreen-button-enter"),o.attr("title",this.options.localize.fullscreen)})}e.registerButtons(),setTimeout(function(){e.trigger("resize")},200)},p.prototype.getXAPIData=function(){var e=this.createXAPIEventTemplate("answered");return this.addQuestionToXAPI(e),this.addResponseToXAPI(e),{statement:e.data.statement}},p.prototype.addQuestionToXAPI=function(e){var t=e.getVerifiedStatementValue(["object","definition"]);d.extend(t,this.getXAPIDefinition())},p.prototype.getXAPIDefinition=function(){var e={};e.description={"en-US":d("<div>"+this.options.question.settings.questionTitle+"</div>").text()},e.type="http://adlnet.gov/expapi/activities/cmi.interaction",e.interactionType="matching",e.source=[];for(var t=0;t<this.options.question.task.elements.length;t++){var n=this.options.question.task.elements[t];if(n.dropZones&&n.dropZones.length){var o=n.type.params.alt?n.type.params.alt:n.type.params.text;e.source.push({id:""+t,description:{"en-US":d("<div>"+o+"</div>").text()}})}}e.correctResponsesPattern=[""],e.target=[];var i=!0;for(t=0;t<this.options.question.task.dropZones.length;t++)if(e.target.push({id:""+t,description:{"en-US":d("<div>"+this.options.question.task.dropZones[t].label+"</div>").text()}}),this.options.question.task.dropZones[t].correctElements)for(var r=0;r<this.options.question.task.dropZones[t].correctElements.length;r++)i||(e.correctResponsesPattern[0]+="[,]"),e.correctResponsesPattern[0]+=t+"[.]"+this.options.question.task.dropZones[t].correctElements[r],i=!1;return e},p.prototype.addResponseToXAPI=function(e){var t=this.getMaxScore(),n=this.getScore(),o=n==t;e.setScoredResult(n,t,this,!0,o),e.data.statement.result.response=this.getUserXAPIResponse()},p.prototype.getUserXAPIResponse=function(){var e=this.getUserAnswers();return e?e.filter(function(e){return e.elements.length}).map(function(e,t){return e.elements.filter(function(e){return void 0!==e.dropZone}).map(function(e){return e.dropZone+"[.]"+t}).join("[,]")}).filter(function(e){return void 0!==e&&""!==e}).join("[,]"):""},p.prototype.getUserAnswers=function(){return this.draggables.map(function(e,t){return{index:t,draggable:e}}).filter(function(e){return void 0!==e.draggable&&e.draggable.elements}).map(function(e){return{index:e.index,elements:e.draggable.elements}})},p.prototype.createQuestionContent=function(){var e;this.$container=d('<div class="h5p-inner" role="application" aria-labelledby="dq-intro-'+h+'"></div>'),void 0!==this.options.question.settings.background?this.$container.css("backgroundImage",'url("'+H5P.getPath(this.options.question.settings.background.path,this.id)+'")'):void 0!==this.backgroundColor&&this.$container.css("background-color",this.backgroundColor);var t=this.options.question.task;for(e=0;e<t.elements.length;e++){var n=t.elements[e];if(void 0!==n.dropZones&&0!==n.dropZones.length)this.draggables[e].appendTo(this.$container,this.id);else{var o=this.addElement(n,"static",e);H5P.newRunnable(n.type,this.id,o),0===n.type.library.indexOf("H5P.Image ")&&o.find("img").attr("title",n.type.params.title||"");!function(e,t){setTimeout(function(){a.default.setOpacity(e,"background",t.backgroundOpacity)},0)}(o,n)}}for(this.$noDropZone.appendTo(this.$container),e=0;e<this.dropZones.length;e++)this.dropZones[e].appendTo(this.$container,this.draggables);return this.$container},p.prototype.registerButtons=function(){this.options.behaviour.enableCheckButton&&this.addSolutionButton(),this.addRetryButton(),this.oneDropzonesHasCorrectElement()&&(this.addShowSolutionButton(),this.options.behaviour.randomizeDraggables&&this.reTry())},p.prototype.addSolutionButton=function(){var e=this;this.addButton("check-answer",this.options.scoreShow,function(){e.answerChecked=!0,e.showAllSolutions(),e.showScore(),e.addExplanation(),d(".h5p-question-explanation").show();var t=e.createXAPIEventTemplate("answered");e.addQuestionToXAPI(t),e.addResponseToXAPI(t),e.trigger(t),e.options.behaviour.removeCorrectWrongStyles&&e.maxScoreReached&&e.draggables.forEach(function(e){e.elements.forEach(function(e){e.$.hasClass("h5p-correct")&&e.$.removeClass("h5p-correct"),e.$suffix&&e.$suffix.remove()})}),(e.$introduction?e.$introduction:e.$container.children().first()).focus()})},p.prototype.addExplanation=function(){var e=this,t=[];this.options.question.task.dropZones.forEach(function(n,o){var i={correct:n.tipsAndFeedback.feedbackOnCorrect,incorrect:n.tipsAndFeedback.feedbackOnIncorrect};if(void 0!==i.correct||void 0!==i.incorrect){var r=n.correctElements,s={};e.draggables.forEach(function(e){e.elements.forEach(function(t){t.dropZone==o&&(s[e.id]={instance:e,correct:-1!==r.indexOf(""+e.id)})})}),Object.keys(s).forEach(function(e){var r=s[e],l=a.default.strip(r.instance.type.params.alt||r.instance.type.params.text)||"?",u=a.default.strip(n.label);r.correct&&i.correct?(t.push({correct:u+" + "+l,text:i.correct}),r.instance.setFeedback(i.correct,o)):!r.correct&&i.incorrect&&(t.push({correct:u+" + ",wrong:l,text:i.incorrect}),r.instance.setFeedback(i.incorrect,o))})}}),0!==t.length&&this.setExplanation(t,this.options.feedbackHeader)},p.prototype.addRetryButton=function(){var e=this;this.addButton("try-again",this.options.tryAgain,function(){var t=!1;e.solutionViewed&&(t=!0,e.solutionViewed=!1),e.maxScoreReached&&(t=!0,e.maxScoreReached=!1),e.reTry(t),e.showButton("check-answer"),e.hideButton("try-again"),e.hideButton("show-solution")},!1)},p.prototype.isAnswerSelected=function(){return this.$container.find(".h5p-dropped").length>=this.draggables.length},p.prototype.oneDropzonesHasCorrectElement=function(){for(var e=this.options.question.task,t=0;t<e.dropZones.length;t++)if(0!==e.dropZones[t].correctElements.length)return!0;return!1},p.prototype.addShowSolutionButton=function(){var e=this;this.addButton("show-solution",this.options.showSolutionButton,function(){if(e.options.behaviour.showSolutionsRequiresInput&&!e.isAnswerSelected())return e.updateFeedbackContent(e.options.noInput),e.read(e.options.noInput),void e.hideButton("show-solution");e.showSolution(),e.hideButton("check-answer"),e.hideButton("show-solution"),e.showButton("try-again"),e.read(e.options.displaySolutionDescription)},!1)},p.prototype.addElement=function(e,t,n){return d('<div class="h5p-'+t+'" style="left:'+e.x+"%;top:"+e.y+"%;width:"+e.width+"em;height:"+e.height+'em"></div>').appendTo(this.$container).data("id",n)},p.prototype.resize=function(e){var t=this;if(void 0!==this.$container&&this.$container.is(":visible")){var n=e&&e.data&&e.data.decreaseSize;n||(this.$container.css("height","99999px"),t.$container.parents(".h5p-standalone.h5p-dragquestion").css("width",""));var o=this.options.question.settings.size,i=o.width/o.height,r=this.$container.parent(),s=r.width()-parseFloat(r.css("margin-left"))-parseFloat(r.css("margin-right")),a=t.$container.parents(".h5p-standalone.h5p-dragquestion.h5p-semi-fullscreen");if(a.length){a.css("width",""),n||(t.$container.css("width","10px"),a.css("width",""),setTimeout(function(){t.trigger("resize",{decreaseSize:!0})},200));var l=d(window.frameElement);if(l)s=l.parent().width(),a.css("width",s+"px")}var u=s/i;s<=0&&(s=o.width,u=o.height),this.$container.css({width:s+"px",height:u+"px",fontSize:s/o.width*16+"px"})}},p.prototype.disableDraggables=function(){this.draggables.forEach(function(e){e.disable()})},p.prototype.enableDraggables=function(){this.draggables.forEach(function(e){e.enable()})},p.prototype.showAllSolutions=function(e){var t;this.points=0,this.rawPoints=0,this.allSolutionsViewed=!0,this.blankIsCorrect&&(this.points=1,this.rawPoints=1),!e&&this.options.behaviour.showScorePoints&&!this.options.behaviour.singlePoint&&this.options.behaviour.applyPenalties&&(t=new H5P.Question.ScorePoints,this.scoreInline=this.options.behaviour.showScoreInline),this.maxScoreReached=!1;for(var n=0;n<this.draggables.length;n++){var o=this.draggables[n];void 0!==o&&(e||o.disable(),this.points+=o.results(e,this.correctDZs[n],t,this.scoreInline),this.rawPoints+=o.rawPoints)}this.points<0&&(this.points=0),!this.answered&&this.blankIsCorrect&&(this.points=this.weight),this.options.behaviour.singlePoint&&(this.points=this.points===this.calculateMaxScore()?1:0),e||this.hideButton("check-answer"),this.options.behaviour.enableRetry&&!e&&this.showButton("try-again"),this.options.behaviour.enableSolutionButton&&!e&&this.showButton("show-solution"),this.points===this.getMaxScore()&&(this.maxScoreReached=!0),!this.hasButton("check-answer")||!1!==this.options.behaviour.enableRetry&&this.points!==this.getMaxScore()||this.hideButton("show-solution")},p.prototype.showSolutions=function(){this.solutionViewed||(this.answerChecked||this.showAllSolutions(),this.scoreViewed||this.showScore(),this.showSolution(),this.hideButton("check-answer"),this.hideButton("try-again"))},p.prototype.reTry=function(e){var t=this;if(this.points=0,this.rawPoints=0,this.answered=!1,this.solutionViewed=!1,this.answerChecked=!1,this.scoreViewed=!1,this.draggables.forEach(function(e){e.elements.forEach(function(e){e.$.hasClass("h5p-question-hidden")&&e.$.removeClass("h5p-question-hidden")})}),this.enableDraggables(),t.options.behaviour.randomizeDraggables){var n=[];this.draggables.forEach(function(e){e.elements&&!e.multiple&&n.push([e.x,e.y])}),n=H5P.shuffleArray(n);for(var o=0,i=0;i<this.draggables.length;i++){var r=this.draggables[i];if(void 0===r||r.multiple)o++;else{r.id;var s=!0;r.elements[0].$.hasClass("h5p-correct")&&(s=!1);var a=n[i-o][0],l=n[i-o][1];r.shufflePosition(s,a,l)}}}this.hasSavedState||this.draggables.forEach(function(n){t.options.behaviour.keepCorrectAnswers&&!e?n.resetPosition(t.correctDZs[n.id]):n.resetPosition()}),this.hasSavedState=!1,this.showButton("check-answer"),this.hideButton("try-again"),this.removeFeedback(),this.setExplanation()},p.prototype.showSolution=function(){this.solutionViewed=!0;var e=this.dropZones;for(n=0;n<e.length;n++){e[n].alignables=[]}for(var t=[],n=0;n<this.draggables.length;n++){void 0!==(u=this.draggables[n])&&(t[u.id]=this.correctDZs[n])}var o=[],i=!1;for(n=0;n<this.draggables.length;n++){if(void 0!==(u=this.draggables[n])){if(u.multiple){i=!0;var r=u.id,s=t[r];if(s){if(o[r]=s.length,u.elements=u.elements.filter(function(e){return void 0!=e}),void 0==(c=u.elements[0]).dropZone){var a=u.elements;a.push(a.shift())}for(var l=0;l<u.elements.length;l++){(c=u.elements[l]).$.hasClass("h5p-correct")&&o[r]--}}}}}if(i)for(n=0;n<this.draggables.length;n++){if(void 0!==(u=this.draggables[n])){r=u.id;if(u.multiple)for(l=0;l<o[r];l++){void 0!==(c=u.elements[l])&&c.clone()}}}this.draggables.forEach(function(n){var o=n.id,i=t[o],r=n.multiple;if(r&&i)for(var s=[],a=0;a<i.length;a++)s.push(i[a]);var l=0;n.elements.forEach(function(t){if(t.$suffix&&t.$suffix.remove(),i)if(r&&t.$.hasClass("h5p-wrong")&&t.$.addClass("h5p-question-hidden"),r)if(t.$.hasClass("h5p-correct")){var o=s.indexOf(t.dropZone),a=t.dropZone;-1===(c=e[a]).getIndexOf(t.$)&&c.alignables.push(t.$),s.splice(o,1)}else{if(!t.$.hasClass("h5p-wrong"))if(!t.$.hasClass("h5p-dropped"))if(void 0!==(c=e[s[l]])){t.$.addClass("h5p-question-solution"),t.dropZone=c.id;t.$.attr("class");n.updatePlacement(t),t.$.css({left:c.x+"%",top:c.y+"%"}),-1===c.getIndexOf(t.$)&&c.alignables.push(t.$),t.dropZone="",l++}}else for(var u=0;u<i.length;u++){var c;t.$.addClass("h5p-question-solution"),void 0!==(c=e[i[u]])&&(n.addToDropZone(0,t,c.id),t.$.css({left:c.x+"%",top:c.y+"%"}),t.$.hasClass("h5p-wrong")&&t.$.addClass("h5p-question-solution"),-1===c.getIndexOf(t.$)&&c.alignables.push(t.$))}else t.$.hasClass("h5p-dropped")&&t.$.addClass("h5p-question-hidden")})});for(n=0;n<this.draggables.length;n++){var u;if(void 0!==(u=this.draggables[n]))for(l=0;l<u.elements.length;l++){var c;(c=u.elements[l]).$.hasClass("h5p-correct")||c.$.hasClass("h5p-question-solution")||c.$.addClass("h5p-question-hidden"),this.options.behaviour.removeCorrectWrongStyles&&c.$.removeClass("h5p-wrong").removeClass("h5p-correct")}}for(n=0;n<e.length;n++){e[n].autoAlign()}this.disableDraggables(),this.showButton("try-again"),this.hideButton("show-solution"),d(".h5p-question-explanation").hide()},p.prototype.resetTask=function(){this.reTry(!0)},p.prototype.calculateMaxScore=function(){var e=0;if(this.blankIsCorrect)return 1;for(var t=this.options.question.task.elements,n=0;n<t.length;n++){var o=this.correctDZs[n];void 0!==o&&o.length&&(t[n].multiple?e+=o.length:e++)}return e},p.prototype.getMaxScore=function(){return this.options.behaviour.singlePoint?this.weight:this.calculateMaxScore()},p.prototype.getScore=function(){this.showAllSolutions(!0);var e=this.options.behaviour.applyPenalties||this.options.behaviour.singlePoint?this.points:this.rawPoints;return delete this.points,delete this.rawPoints,e},p.prototype.getAnswerGiven=function(){return!this.options.behaviour.showSolutionsRequiresInput||this.answered||this.blankIsCorrect},p.prototype.showScore=function(){this.scoreViewed=!0;var e=this.calculateMaxScore();this.options.behaviour.singlePoint&&(e=1);var t=this.options.behaviour.applyPenalties||this.options.behaviour.singlePoint?this.points:this.rawPoints,n=H5P.Question.determineOverallFeedback(this.options.overallFeedback,t/e).replace("@score",t).replace("@total",e),o=!(!this.options.behaviour.enableScoreExplanation||!this.options.behaviour.applyPenalties)&&this.options.scoreExplanation;this.setFeedback(n,t,e,this.options.scoreBarLabel,o,void 0,this.options.scoreExplanationButtonLabel)},p.prototype.getCurrentState=function(){for(var e={answers:[]},t=0;t<this.draggables.length;t++){var n=this.draggables[t];if(void 0!==n){for(var o=[],i=0;i<n.elements.length;i++){var r=n.elements[i];void 0===r||void 0===r.dropZone||r.$.hasClass("h5p-question-solution")||r.$.hasClass("h5p-question-hidden")||o.push({x:Number(r.position.left.replace("%","")),y:Number(r.position.top.replace("%","")),dz:r.dropZone})}o.length&&(e.answers[t]=o)}}return e},p.prototype.getCopyrights=function(){var e=this,t=new H5P.ContentCopyrights,n=e.options.question.settings.background;if(void 0!==n&&void 0!==n.copyright){var o=new H5P.MediaCopyright(n.copyright);o.setThumbnail(new H5P.Thumbnail(H5P.getPath(n.path,e.id),n.width,n.height)),t.addMedia(o)}for(var i=0;i<e.options.question.task.elements.length;i++){var r=e.options.question.task.elements[i],s=H5P.newRunnable(r.type,e.id);if(void 0!==s.getCopyrights){var a=s.getCopyrights();a.setLabel((r.dropZones.length?"Draggable ":"Static ")+(void 0!==r.type.params.contentName?r.type.params.contentName:"element")),t.addContent(a)}}return t},p.prototype.getTitle=function(){return H5P.createTitle(this.options.question.settings.questionTitle)};var g=function(e,t,n){var l,u={drag:new o.default([new s.default,new i.default]),drop:new o.default([new s.default,new r.default])};u.drag.useNegativeTabIndex(),u.drop.useNegativeTabIndex();var c=function(){l.draggable.trigger("dragend"),l.element.$.removeClass("h5p-draggable-hover"),a.default.setElementOpacity(l.element.$,l.draggable.backgroundOpacity),-1!==u.drop.elements.indexOf(n)&&(u.drop.removeElement(n),n.style.display="none");for(var e=0;e<t.length;e++){var o=t[e];o.dehighlight(),-1!==u.drop.elements.indexOf(o.$dropZone[0])&&u.drop.removeElement(o.$dropZone[0])}if(l.element.$.is(":visible"))l.element.$.focus();else{var i=l.draggable.elements[l.draggable.elements.length-1].$;u.drag.setTabbable(i[0]),i.focus()}l=void 0};return u.drag.on("select",function(o){var i=a.default.elementToDraggable(e,o.element);if(l)c();else{var r;(l=i).element.$.addClass("h5p-draggable-hover"),a.default.setElementOpacity(l.element.$,l.draggable.backgroundOpacity),l.draggable.trigger("dragstart",l.draggable.mustCopyElement(l.element)?"copy":"move"),u.drop.addElement(n),n.style.display="block",n.style.left=l.draggable.x+"%",n.style.top=l.draggable.y+"%",n.style.width=l.draggable.width+"em",n.style.height=l.draggable.height+"em";for(var s=0;s<t.length;s++){var d=t[s];d.accepts(l.draggable,e)&&(d.highlight(),u.drop.addElement(d.$dropZone[0]),r&&l.element.dropZone!==d.id||(r=d.$dropZone))}r&&(u.drop.setTabbable(r[0]),r.focus())}}),u.drop.on("select",function(o){if(l){if(o.element===n)return void 0!==l.element.dropZone&&l.element.reset(),l.draggable.multiple||(l.element.$.css({left:l.draggable.x+"%",top:l.draggable.y+"%",width:l.draggable.width+"em",height:l.draggable.height+"em"}),l.draggable.updatePlacement(l.element)),l.element.$[0].setAttribute("aria-grabbed","false"),void c();var i=a.default.elementToDropZone(t,o.element);if(l.draggable.mustCopyElement(l.element)&&l.element.clone(),i.resetSingleDraggables&&i.single)for(var r=0;r<e.length;r++)if(e[r]&&e[r].isInDropZone(i.id)){var s=e[r];s.multiple||s.resetPosition()}else;l.draggable.addToDropZone(l.index,l.element,i.id),l.element.$.css({left:i.x+"%",top:i.y+"%"}),-1===i.getIndexOf(l.element.$)&&i.alignables.push(l.element.$),i.autoAlign(),l.element.$[0].setAttribute("aria-grabbed","false"),c()}}),u};H5P.DragQuestionPapiJo=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=n(1),s=n(0),a=n(5);var l=(0,r.removeAttribute)("tabindex"),u=((0,s.forEach)(l),(0,r.setAttribute)("tabindex","0")),c=(0,r.setAttribute)("tabindex","-1"),d=(0,r.hasAttribute)("tabindex"),h=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),o(this,(0,a.Eventful)()),this.plugins=t||[],this.elements=[],this.negativeTabIndexAllowed=!1,this.on("nextElement",this.nextElement,this),this.on("previousElement",this.previousElement,this),this.initPlugins()}return i(e,[{key:"addElement",value:function(e){this.elements.push(e),this.firesEvent("addElement",e),1===this.elements.length&&this.setTabbable(e)}},{key:"removeElement",value:function(e){this.elements=(0,s.without)([e],this.elements),d(e)&&(this.setUntabbable(e),this.elements[0]&&this.setTabbable(this.elements[0])),this.firesEvent("removeElement",e)}},{key:"firesEvent",value:function(e,t){var n=this.elements.indexOf(t);return this.fire(e,{element:t,index:n,elements:this.elements,oldElement:this.tabbableElement})}},{key:"nextElement",value:function(e){var t=e.index,n=t===this.elements.length-1,o=this.elements[n?0:t+1];this.setTabbable(o),o.focus()}},{key:"setTabbable",value:function(e){(0,s.forEach)(this.setUntabbable.bind(this),this.elements),u(e),this.tabbableElement=e}},{key:"setUntabbable",value:function(e){this.negativeTabIndexAllowed?c(e):l(e)}},{key:"previousElement",value:function(e){var t=e.index,n=0===t,o=this.elements[n?this.elements.length-1:t-1];this.setTabbable(o),o.focus()}},{key:"useNegativeTabIndex",value:function(){this.negativeTabIndexAllowed=!0,this.elements.forEach(function(e){e.hasAttribute("tabindex")||c(e)})}},{key:"initPlugins",value:function(){this.plugins.forEach(function(e){void 0!==e.init&&e.init(this)},this)}}]),e}();t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Eventful=function(){return{listeners:{},on:function(e,t,n){var o={listener:t,scope:n};return this.listeners[e]=this.listeners[e]||[],this.listeners[e].push(o),this},fire:function(e,t){return(this.listeners[e]||[]).every(function(e){return!1!==e.listener.call(e.scope||this,t)})},propagate:function(e,t){var n=this;e.forEach(function(e){return t.on(e,function(t){return n.fire(e,t)})})}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(1),r=n(0);var s="aria-grabbed",a=(0,i.setAttribute)(s),l=(0,i.attributeEquals)(s,"true"),u=(0,r.filter)((0,i.hasAttribute)(s)),c=(0,r.compose)((0,r.forEach)((0,i.setAttribute)(s,"false")),u),d=(0,r.compose)((0,r.some)(l),u),h=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,[{key:"init",value:function(e){this.controls=e,this.controls.on("select",this.select,this)}},{key:"addElement",value:function(e){a("false",e),this.controls.addElement(e)}},{key:"setAllGrabbedToFalse",value:function(){c(this.controls.elements)}},{key:"hasAnyGrabbed",value:function(){return d(this.controls.elements)}},{key:"select",value:function(e){var t=e.element,n=l(t);this.setAllGrabbedToFalse(),n||a("true",t)}}]),e}();t.default=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(1),r=n(0);var s="aria-dropeffect",a=(0,i.setAttribute)(s,"none"),l=(0,i.setAttribute)(s,"move"),u=(0,r.filter)((0,i.hasAttribute)(s)),c=(0,r.compose)((0,r.forEach)(l),u),d=(0,r.compose)((0,r.forEach)(a),u),h=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,[{key:"init",value:function(e){this.controls=e}},{key:"setAllToMove",value:function(){c(this.controls.elements)}},{key:"setAllToNone",value:function(){d(this.controls.elements)}}]),e}();t.default=h,h.DropEffect={COPY:"copy",MOVE:"move",EXECUTE:"execute",POPUP:"popup",NONE:"none"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.selectability=!0}return o(e,[{key:"init",value:function(e){this.boundHandleKeyDown=this.handleKeyDown.bind(this),this.controls=e,this.controls.on("addElement",this.listenForKeyDown,this),this.controls.on("removeElement",this.removeKeyDownListener,this)}},{key:"listenForKeyDown",value:function(e){e.element.addEventListener("keydown",this.boundHandleKeyDown)}},{key:"removeKeyDownListener",value:function(e){e.element.removeEventListener("keydown",this.boundHandleKeyDown)}},{key:"handleKeyDown",value:function(e){switch(e.which){case 13:case 32:this.select(e.target),e.preventDefault();break;case 37:case 38:this.hasChromevoxModifiers(e)||(this.previousElement(e.target),e.preventDefault());break;case 39:case 40:this.hasChromevoxModifiers(e)||(this.nextElement(e.target),e.preventDefault())}}},{key:"hasChromevoxModifiers",value:function(e){return e.shiftKey||e.ctrlKey}},{key:"previousElement",value:function(e){this.controls.firesEvent("previousElement",e)}},{key:"nextElement",value:function(e){this.controls.firesEvent("nextElement",e)}},{key:"select",value:function(e){this.selectability&&!1!==this.controls.firesEvent("before-select",e)&&(this.controls.firesEvent("select",e),this.controls.firesEvent("after-select",e))}},{key:"disableSelectability",value:function(){this.selectability=!1}},{key:"enableSelectability",value:function(){this.selectability=!0}}]),e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=n(2),s=(o=r)&&o.__esModule?o:{default:o};var a=H5P.jQuery,l=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var i=this;H5P.EventDispatcher.call(i),i.id=n,i.showLabel=t.showLabel,i.label=t.label,i.x=t.x,i.y=t.y,i.width=t.width,i.height=t.height,i.backgroundOpacity=t.backgroundOpacity,i.tip=t.tipsAndFeedback.tip||"",i.single=t.single,i.autoAlignable=t.autoAlign,i.alignables=[],i.l10n=o,i.dropzonebordercolor=t.bordercolor,i.background=t.background,i.resetSingleDraggables=t.resetSingleDraggables}return i(e,[{key:"appendTo",value:function(e,t){var n=this,o='<div class="h5p-inner" style="color:'+n.dropzonebordercolor+';"></div>',i="";n.showLabel&&(o='<div class="h5p-label">'+n.label+'<span class="h5p-hidden-read"></span></div>'+o,i=" h5p-has-label"),o='<span class="h5p-hidden-read">'+n.l10n.prefix.replace("{num}",n.id+1)+"</span>"+o;var r=n.backgroundOpacity/100,l=n.background;l=s.default.setAlphas(l,"rgba(",r),l=s.default.setAlphas(l,"rgb(",r),n.$dropZone=a("<div/>",{class:"h5p-dropzone"+i,tabindex:"-1",title:n.showLabel?a("<div/>",{html:n.label}).text():null,role:"button","aria-disabled":!0,css:{left:n.x+"%",top:n.y+"%",width:n.width+"em",height:n.height+"em",background:l},html:o}).appendTo(e).children(".h5p-inner").droppable({activeClass:"h5p-active",tolerance:"intersect",accept:function(e){var o=s.default.elementToDraggable(t,e);return!!o&&n.accepts(o.draggable,t)},drop:function(e,o){var i=a(this);if(n.single)for(var r=0;r<t.length;r++)if(t[r]&&t[r].isInDropZone(n.id)){var l=t[r];l.multiple||l.resetPosition()}else;var u=n.backgroundOpacity/100,c=n.background;c=s.default.setAlphas(c,"rgba(",u),c=s.default.setAlphas(c,"rgb(",u),i.css({backgroundColor:c}),o.draggable.data("addToZone",n.id),-1===n.getIndexOf(o.draggable)&&n.alignables.push(o.draggable),n.autoAlignable.enabled&&n.autoAlign()},over:function(){s.default.setOpacity(a(this).addClass("h5p-over"),"background",n.backgroundOpacity)},out:function(){s.default.setOpacity(a(this).removeClass("h5p-over"),"background",n.backgroundOpacity)}}).end().focus(function(){u instanceof H5P.jQuery&&u.attr("tabindex","0")}).blur(function(){u instanceof H5P.jQuery&&u.attr("tabindex","-1")});var u=H5P.JoubelUI.createTip(n.tip,{tipLabel:n.l10n.tipLabel,tabcontrol:!0});u instanceof H5P.jQuery&&a("<span/>",{class:"h5p-dq-tipwrap","aria-label":n.l10n.tipAvailable,append:u,appendTo:n.$dropZone}),t.forEach(function(e){var t=e.element.$;e.isInDropZone(n.id)&&-1===n.getIndexOf(t)&&n.alignables.push(t)}),n.autoAlignable.enabled&&n.autoAlign(),setTimeout(function(){s.default.setOpacity(n.$dropZone.children(".h5p-label"),"background",n.backgroundOpacity),s.default.setOpacity(n.$dropZone.children(".h5p-inner"),"background",n.backgroundOpacity)},0)}},{key:"accepts",value:function(e,t){if(!e.hasDropZone(this.id))return!1;if(this.single)for(var n=0;n<t.length;n++)if(t[n]&&t[n].isInDropZone(this.id)){var o=t[n],i=!1;if(o.elements.forEach(function(e){e.$.hasClass("h5p-correct")&&(i=!0)}),!this.resetSingleDraggables||o.multiple||i||e.id==o.id)return!1}return!0}},{key:"getIndexOf",value:function(e){for(var t=0;t<this.alignables.length;t++)if(this.alignables[t][0]===e[0])return t;return-1}},{key:"removeAlignable",value:function(e){var t=this,n=t.getIndexOf(e);-1!==n&&(t.alignables.splice(n,1),void 0===t.autoAlignTimer&&t.autoAlignable.enabled&&(t.autoAlignTimer=setTimeout(function(){delete t.autoAlignTimer,t.autoAlign()},1)))}},{key:"autoAlign",value:function(){var e=this,t=e.$dropZone.parent()[0].getBoundingClientRect(),n=(e.autoAlignable.spacing,e.autoAlignable.size.width,e.autoAlignable.spacing,e.autoAlignable.size.height);n={x:0,y:0};for(var o,i,r={x:e.x+n.x,y:e.y+n.y},s=e.$dropZone[0].getBoundingClientRect(),a={x:s.width-2*n.x,y:s.height-2*n.y},l={x:a.x,y:a.y},u=0,c=function(){o.css({left:r.x+"%",top:r.y+"%"}),e.trigger("elementaligned",o);var n=i.width+e.autoAlignable.spacing;l.x-=n,r.x+=n/t.width*100;var s=i.height+e.autoAlignable.spacing;s>u&&(u=s)},d=0;d<e.alignables.length;d++)if(o=e.alignables[d],i=o[0].getBoundingClientRect(),l.x>=i.width)c();else{if(l.x=a.x,r.x=e.x+n.x,u&&(l.y-=u,r.y+=u/t.height*100,u=0),l.y<=0)return;c()}}},{key:"highlight",value:function(){this.$dropZone.attr("aria-disabled","false").children(".h5p-inner").addClass("h5p-active")}},{key:"dehighlight",value:function(){this.$dropZone.attr("aria-disabled","true").children(".h5p-inner").removeClass("h5p-active")}}]),e}();t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=n(2),s=(o=r)&&o.__esModule?o:{default:o};var a=H5P.jQuery,l=function(e){function t(e,n,o,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),s=r;if(s.$=a(s),s.id=n,s.elements=[],s.x=e.x,s.y=e.y,s.width=e.width,s.height=e.height,s.backgroundOpacity=e.backgroundOpacity,s.dropZones=e.dropZones,s.type=e.type,s.multiple=e.multiple,s.l10n=i,o){s.multiple&&s.elements.push({});for(var l=0;l<o.length;l++)s.elements.push({dropZone:o[l].dz,position:{left:o[l].x+"%",top:o[l].y+"%"}})}return r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,H5P.EventDispatcher),i(t,[{key:"appendTo",value:function(e,t){if(this.elements.length)for(var n=0;n<this.elements.length;n++)this.attachElement(n,e,t);else this.attachElement(null,e,t)}},{key:"attachElement",value:function(e,t,n){var o,i=this;null===e?(o={},i.elements.push(o),e=i.elements.length-1):o=i.elements[e],a.extend(o,{clone:function(){i.attachElement(null,t,n)},reset:function(){void 0!==o.dropZone&&(i.trigger("leavingDropZone",o),delete o.dropZone),i.multiple&&(o.$.remove(),delete i.elements[e],i.trigger("elementremove",o.$[0])),delete o.position}}),o.$=a("<div/>",{class:"h5p-draggable",tabindex:"-1",role:"button",css:{left:i.x+"%",top:i.y+"%",width:i.width+"em",height:i.height+"em"},appendTo:t}).on("click",function(){i.trigger("focus",this)}).draggable({revert:function(e){t.removeClass("h5p-dragging");var n=a(this);return n.data("uiDraggable").originalPosition={top:i.y+"%",left:i.x+"%"},i.updatePlacement(o),n[0].setAttribute("aria-grabbed","false"),i.trigger("dragend"),!e},start:function(){var e=a(this),n=i.mustCopyElement(o);n&&o.clone(),e.removeClass("h5p-wrong").detach().appendTo(t),t.addClass("h5p-dragging"),s.default.setElementOpacity(e,i.backgroundOpacity),this.setAttribute("aria-grabbed","true"),i.trigger("focus",this),i.trigger("dragstart",{element:this,effect:n?"copy":"move"})},stop:function(){var n=a(this);o.position=s.default.positionToPercentage(t,n),n.css(o.position);var r=n.data("addToZone");void 0!==r?(n.removeData("addToZone"),i.addToDropZone(e,o,r)):o.reset()}}).css("position",""),i.element=o,o.position&&(o.$.css(o.position),i.updatePlacement(o)),s.default.addHover(o.$,i.backgroundOpacity),H5P.newRunnable(i.type,n,o.$),0===i.type.library.indexOf("H5P.Image ")&&o.$.find("img").attr("title",i.type.params.title||""),a('<span class="h5p-hidden-read">'+i.l10n.prefix.replace("{num}",i.id+1)+"</span>").prependTo(o.$),a('<span class="h5p-hidden-read"></span>').appendTo(o.$),setTimeout(function(){s.default.setElementOpacity(o.$,i.backgroundOpacity)},0),i.trigger("elementadd",o.$[0])}},{key:"setFeedback",value:function(e,t){this.elements.forEach(function(n){n.dropZone===t&&(void 0===n.$feedback&&(n.$feedback=a("<span>",{class:"h5p-hidden-read",appendTo:n.$})),n.$feedback.html(e))})}},{key:"mustCopyElement",value:function(e){return this.multiple&&void 0===e.dropZone}},{key:"hasDropZone",value:function(e){for(var t=0;t<this.dropZones.length;t++)if(parseInt(this.dropZones[t])===e)return!0;return!1}},{key:"addToDropZone",value:function(e,t,n){var o=this;if(o.multiple)for(var i=0;i<o.elements.length;i++)if(i!==e&&void 0!==o.elements[i]&&o.elements[i].dropZone===n)return void 0!==o.elements[e].dropZone&&o.elements[e].dropZone!==n&&o.trigger("leavingDropZone",t),t.$.remove(),delete o.elements[e],void o.trigger("elementremove",o.element.$[0]);void 0!==t.dropZone&&t.dropZone!==n&&o.trigger("leavingDropZone",t),t.dropZone=n,o.updatePlacement(t),o.trigger("interacted")}},{key:"updatePlacement",value:function(e){e.$suffix&&e.$suffix.remove(),void 0!==e.dropZone?(e.$.addClass("h5p-dropped"),s.default.setElementOpacity(e.$,this.backgroundOpacity),e.$suffix=a('<span class="h5p-hidden-read">'+this.l10n.suffix.replace("{num}",e.dropZone+1)+". </span>").appendTo(e.$)):(e.$.removeClass("h5p-dropped").removeClass("h5p-wrong").removeClass("h5p-correct").removeClass("h5p-question-solution").css({border:"",background:""}),s.default.setElementOpacity(e.$,this.backgroundOpacity))}},{key:"resetPosition",value:function(e){var t=this,n=!1,o=void 0!==e;this.elements.forEach(function(i){if(i.$feedback&&(i.$feedback.remove(),delete i.$feedback),void 0!==i.dropZone){var r;if(o&&-1!==a.inArray(i.dropZone,e))return n=!0,void(r=t.elements[t.elements.indexOf(i)]).$.draggable("disable");(r=i.$).animate({left:t.x+"%",top:t.y+"%"},function(){t.multiple&&(void 0!==r.dropZone&&t.trigger("leavingDropZone",r),r.remove(),t.elements.indexOf(i)>=0&&delete t.elements[t.elements.indexOf(i)],t.trigger("elementremove",r[0]))}),t.updatePlacement(i)}}),!1===n&&(void 0!==t.element.dropZone&&(t.trigger("leavingDropZone",t.element),delete t.element.dropZone),t.updatePlacement(t.element))}},{key:"shufflePosition",value:function(e,t,n){this.x=t,this.y=n;var o=this;e&&this.elements.forEach(function(e){e.$.animate({left:o.x+"%",top:o.y+"%"},function(){})})}},{key:"findElement",value:function(e){for(var t=0;t<this.elements.length;t++)if(void 0!==this.elements[t]&&this.elements[t].$.is(e))return{element:this.elements[t],index:t}}},{key:"isInDropZone",value:function(e){for(var t=0;t<this.elements.length;t++)if(void 0!==this.elements[t]&&this.elements[t].dropZone===e)return!0;return!1}},{key:"disable",value:function(){for(var e=0;e<this.elements.length;e++){var t=this.elements[e];t&&(t.$.draggable("disable"),this.trigger("elementremove",t.$[0]))}}},{key:"enable",value:function(){for(var e=0;e<this.elements.length;e++){var t=this.elements[e];t&&(t.$.draggable("enable"),this.trigger("elementadd",t.$[0]))}}},{key:"results",value:function(e,t,n,o){var i,r,s,a,l=this,u=0;if(l.rawPoints=0,void 0===t){for(i=0;i<l.elements.length;i++)void 0!==(s=l.elements[i])&&void 0!==s.dropZone&&(!0!==e&&l.markElement(s,"wrong",n,o),u--);return u}for(i=0;i<l.elements.length;i++)if(void 0!==(s=l.elements[i])&&void 0!==s.dropZone){for(a=!1,r=0;r<t.length;r++)if(s.dropZone===t[r]){!0!==e&&1==s.$suffix.length&&l.markElement(s,"correct",n,o),s.$.hasClass("h5p-question-solution")||(l.rawPoints++,u++),a=!0;break}a||(!0!==e&&l.markElement(s,"wrong",n,o),s.$.hasClass("h5p-question-solution")||u--)}return u}},{key:"markElement",value:function(e,t,n,o){var i=a("<span/>",{class:"h5p-hidden-read",html:this.l10n[t+"Answer"]});n&&(i=i.add(n.getElement("correct"===t))),e.$suffix=e.$suffix.add(i),!0===o?(e.$suffix.addClass("h5p-question-score-inline"),e.$.addClass("h5p-"+t+" h5p-dg-inline").append(i)):(e.$suffix.addClass("h5p-question-score-normal"),e.$.addClass("h5p-"+t+" h5p-dg-normal").append(i)),s.default.setElementOpacity(e.$,this.backgroundOpacity)}}]),t}();t.default=l}]);