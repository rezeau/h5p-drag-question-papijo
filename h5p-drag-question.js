!function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};t.m=e,t.c=n,t.d=function(e,n,o){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:o})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=t.curry=function(e){var t=e.length;return function n(){var o=Array.prototype.slice.call(arguments,0);return o.length>=t?e.apply(null,o):function(){var e=Array.prototype.slice.call(arguments,0);return n.apply(null,o.concat(e))}}},r=(t.compose=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(function(e,t){return function(){return e(t.apply(void 0,arguments))}})},t.forEach=o(function(e,t){t.forEach(e)}),t.map=o(function(e,t){return t.map(e)}),t.filter=o(function(e,t){return t.filter(e)})),i=(t.some=o(function(e,t){return t.some(e)}),t.contains=o(function(e,t){return-1!=t.indexOf(e)}));t.without=o(function(e,t){return r(function(t){return!i(t,e)},t)}),t.inverseBooleanString=function(e){return("true"!==e).toString()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createElement=t.toggleClass=t.toggleVisibility=t.show=t.hide=t.removeClass=t.addClass=t.classListContains=t.removeChild=t.querySelectorAll=t.nodeListToArray=t.querySelector=t.appendChild=t.toggleAttribute=t.attributeEquals=t.hasAttribute=t.removeAttribute=t.setAttribute=t.getAttribute=void 0;var o=n(0),r=t.getAttribute=(0,o.curry)(function(e,t){return t.getAttribute(e)}),i=t.setAttribute=(0,o.curry)(function(e,t,n){return n.setAttribute(e,t)}),a=(t.removeAttribute=(0,o.curry)(function(e,t){return t.removeAttribute(e)}),t.hasAttribute=(0,o.curry)(function(e,t){return t.hasAttribute(e)}),t.attributeEquals=(0,o.curry)(function(e,t,n){return n.getAttribute(e)===t}),t.toggleAttribute=(0,o.curry)(function(e,t){var n=r(e,t);i(e,(0,o.inverseBooleanString)(n),t)}),t.appendChild=(0,o.curry)(function(e,t){return e.appendChild(t)}),t.querySelector=(0,o.curry)(function(e,t){return t.querySelector(e)}),t.nodeListToArray=function(e){return Array.prototype.slice.call(e)}),s=(t.querySelectorAll=(0,o.curry)(function(e,t){return a(t.querySelectorAll(e))}),t.removeChild=(0,o.curry)(function(e,t){return e.removeChild(t)}),t.classListContains=(0,o.curry)(function(e,t){return t.classList.contains(e)}),t.addClass=(0,o.curry)(function(e,t){return t.classList.add(e)})),l=t.removeClass=(0,o.curry)(function(e,t){return t.classList.remove(e)}),u=t.hide=s("hidden"),c=t.show=l("hidden");t.toggleVisibility=(0,o.curry)(function(e,t){return(e?c:u)(t)}),t.toggleClass=(0,o.curry)(function(e,t,n){n.classList[t?"add":"remove"](e)}),t.createElement=function(e){var t=e.tag,n=e.id,o=e.classes,r=e.attributes,i=document.createElement(t);return n&&(i.id=n),o&&o.forEach(function(e){i.classList.add(e)}),r&&Object.keys(r).forEach(function(e){i.setAttribute(e,r[e])}),i}},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=function(){function e(){o(this,e)}return r(e,null,[{key:"setElementOpacity",value:function(t,n){e.setOpacity(t,"borderColor",n),e.setOpacity(t,"boxShadow",n),e.setOpacity(t,"background",n)}},{key:"setOpacity",value:function(t,n,o){function r(e,t){switch(e){case"borderColor":return{borderTopColor:t,borderRightColor:t,borderBottomColor:t,borderLeftColor:t};default:var n={};return n[e]=t,n}}if("background"===n)return e.setOpacity(t,"backgroundColor",o),void e.setOpacity(t,"backgroundImage",o);o=void 0===o?1:o/100;var i=t.css(n),a=r(n,"");t.css(a);for(var s in a)break;var l=t.css(s);""!==l&&"none"!==l||(l=i),l=e.setAlphas(l,"rgba(",o),l=e.setAlphas(l,"rgb(",o),t.css(r(n,l))}},{key:"setAlphas",value:function(e,t,n){if(e){for(var o=e.indexOf(t);-1!==o;){var r=e.indexOf(")",o),i=e.substring(o+t.length,r).split(",");i[3]=void 0!==i[3]?parseFloat(i[3])*n:n,e=e.substring(0,o)+"rgba("+i.join(",")+e.substring(r,e.length),o=e.indexOf(t,r)}return e}}},{key:"elementToDraggable",value:function(e,t){for(var n=0;n<e.length;n++)if(e[n]){var o=e[n].findElement(t);if(o)return o.draggable=e[n],o}}},{key:"elementToDropZone",value:function(e,t){for(var n=0;n<e.length;n++)if(e[n].$dropZone.is(t))return e[n]}},{key:"positionToPercentage",value:function(e,t){return{top:100*parseInt(t.css("top"))/e.innerHeight()+"%",left:100*parseInt(t.css("left"))/e.innerWidth()+"%"}}},{key:"addHover",value:function(t,n){t.hover(function(){t.addClass("h5p-draggable-hover"),t.parent().hasClass("h5p-dragging")||e.setElementOpacity(t,n)},function(){t.parent().hasClass("h5p-dragging")||setTimeout(function(){t.removeClass("h5p-draggable-hover"),e.setElementOpacity(t,n)},1)}),e.setElementOpacity(t,n)}},{key:"strip",value:function(e){var t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""}}]),e}();t.default=i},function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t,n){var o,r,i=this;k++,this.id=this.contentId=t,H5P.Question.call(i,"dragquestion"),this.options=y.extend(!0,{},{description:"Task description",scoreShow:"Check",tryAgain:"Retry",showSolutionButton:"Show solution",grabbablePrefix:"Grabbable {num} of {total}.",grabbableSuffix:"Placed in dropzone {num}.",dropzonePrefix:"Dropzone {num} of {total}.",noDropzone:"No dropzone",tipLabel:"Show tip.",tipAvailable:"Tip available",correctAnswer:"Correct answer",wrongAnswer:"Wrong answer",correctNumber:"Correct number: ",inCorrectNumber:"Incorrect number: ",correctValue:"Correct total value: ",inCorrectValue:"Incorrect total value: ",feedbackHeader:"Feedback",scoreBarLabel:"You got :num out of :total points",scoreExplanationButtonLabel:"Show score explanation",displaySolutionDescription:"Task is updated to contain the solution.",noInput:"Please answer before viewing the solution",question:{settings:{questionTitle:"Drag and drop",showTitle:!0,size:{width:620,height:310}},task:{elements:[],dropZones:[]}},overallFeedback:[],behaviour:{enableRetry:!0,enableSolutionButton:!1,enableCheckButton:!0,preventResize:!1,singlePoint:!1,showSolutionsRequiresInput:!0,removeCorrectWrongStyles:!1,applyPenalties:!0,enableScoreExplanation:!0,enableScoreExplanationQuantity:!0,dropZoneHighlighting:"dragging",autoAlignSpacing:2,showScorePoints:!0,showScoreInline:!1,keepCorrectAnswers:!1,disableCompletedDropZones:!1,randomizeDraggables:!1,resetSingleDraggables:!1,enableDroppedQuantity:!1}},e),(this.options.behaviour.singlePoint||this.options.behaviour.enableDroppedQuantity)&&(this.options.behaviour.enableScoreExplanation=!1),this.options.behaviour.enableDroppedQuantity||(this.options.behaviour.enableScoreExplanationQuantity=!1),this.draggables=[],this.dropZones=[],this.nbDraggables=[],this.nbPlacedDraggables=[];var a=this.options.question.task;for(o=0;o<a.dropZones.length;o++){var s=a.dropZones[o];this.nbDraggables[o]=0,this.nbPlacedDraggables[o]=0}this.answered=void 0!==n&&void 0!==n.previousState&&void 0!==n.previousState.answers&&0!==n.previousState.answers.length,this.hasSavedState=this.answered,this.blankIsCorrect=!0,this.backgroundOpacity=void 0===this.options.behaviour.backgroundOpacity||""===this.options.behaviour.backgroundOpacity?void 0:this.options.behaviour.backgroundOpacity,this.backgroundColor="rgba(255, 255, 255, 0)"===this.options.question.settings.backgroundColor?void 0:this.options.question.settings.backgroundColor,this.backgroundOpacityDropZones=void 0===this.options.behaviour.backgroundOpacityDropZones||""===this.options.behaviour.backgroundOpacityDropZones?void 0:this.options.behaviour.backgroundOpacityDropZones,this.overrideBorderColor="rgba(0, 0, 0, 0)"===this.options.behaviour.overrideBorderColor?void 0:this.options.behaviour.overrideBorderColor,this.dropZonesBackgroundColor=void 0===this.options.behaviour.dropZonesBackgroundColor?"rgb(245, 245, 245)":this.options.behaviour.dropZonesBackgroundColor,this.solutionViewed=!1,this.answerChecked=!1,this.scoreViewed=!1,this.maxScoreReached=!1,i.$noDropZone=y('<div class="h5p-dq-no-dz" role="button" style="display:none;"><span class="h5p-hidden-read">'+i.options.noDropzone+"</span></div>");var l=w(i.draggables,i.dropZones,i.$noDropZone[0]),u=function(e){for(var t=0;t<l.drop.elements.length;t++)l.drop.elements[t].setAttribute("aria-dropeffect",e)},c=[],a=this.options.question.task;for(this.correctDZs=[],o=0;o<a.dropZones.length;o++){c.push(!0);var d=a.dropZones[o].correctElements;a.dropZones[o].acceptedNumber;for(r=0;r<d.length;r++){var h=d[r];void 0===this.correctDZs[h]&&(this.correctDZs[h]=[]),this.correctDZs[h].push(o)}void 0!==this.overrideBorderColor&&(a.dropZones[o].bordercolor=this.overrideBorderColor),a.dropZones[o].background=this.dropZonesBackgroundColor}this.weight=1;var p={prefix:i.options.grabbablePrefix.replace("{total}",a.elements.length),suffix:i.options.grabbableSuffix,correctAnswer:i.options.correctAnswer,wrongAnswer:i.options.wrongAnswer};for(o=0;o<a.elements.length;o++){var f=a.elements[o];if(this.options.behaviour.enableDroppedQuantity&&(f.multiple=!1),void 0!==f.dropZones&&f.dropZones.length){void 0!==this.backgroundOpacity&&(f.backgroundOpacity=this.backgroundOpacity);var v=null;n&&void 0!==n.previousState&&void 0!==n.previousState.answers&&void 0!==n.previousState.answers[o]&&(v=n.previousState.answers[o]);var C=new m.default(f,o,v,p),x="dragging"===i.options.behaviour.dropZoneHighlighting;for(C.on("elementadd",function(e){l.drag.addElement(e.data)}),C.on("elementremove",function(e){l.drag.removeElement(e.data),"true"===e.data.getAttribute("aria-grabbed")&&(l.drag.firesEvent("select",e.data),e.data.removeAttribute("aria-grabbed"))}),C.on("focus",function(e){l.drag.setTabbable(e.data),e.data.focus()}),C.on("dragstart",function(e){x&&i.$container.addClass("h5p-dq-highlight-dz"),u(e.data)}),C.on("dragend",function(){x&&i.$container.removeClass("h5p-dq-highlight-dz"),u("none")}),C.on("interacted",function(){i.answered=!0,i.triggerXAPIScored(i.getScore(),i.getMaxScore(),"interacted")}),C.on("leavingDropZone",function(e){i.dropZones[e.data.dropZone].removeAlignable(e.data.$)}),this.draggables[o]=C,r=0;r<f.dropZones.length;r++)c[f.dropZones[r]]=!1}}if(this.options.behaviour.enableDroppedQuantity)for(this.correctDraggables=[],o=0;o<a.dropZones.length;o++)for(this.correctDraggables[o]=[],r=0;r<this.correctDZs.length;r++)if(void 0!=this.correctDZs[r]){var $=y.inArray(o,this.correctDZs[r]);-1!==$&&this.correctDraggables[o].push(r)}this.numDropZonesWithoutElements=0;var E={prefix:i.options.dropzonePrefix.replace("{total}",a.dropZones.length),tipLabel:i.options.tipLabel,tipAvailable:i.options.tipAvailable};for(o=0;o<a.dropZones.length;o++){var s=a.dropZones[o];this.options.behaviour.enableDroppedQuantity&&(s.single=!1),!0===c[o]&&(this.numDropZonesWithoutElements+=1),this.blankIsCorrect&&s.correctElements.length&&(this.blankIsCorrect=!1),void 0!==this.backgroundOpacityDropZones&&(s.backgroundOpacity=this.backgroundOpacityDropZones),s.resetSingleDraggables=this.options.behaviour.resetSingleDraggables,s.autoAlign={enabled:s.autoAlign,spacing:i.options.behaviour.autoAlignSpacing,size:i.options.question.settings.size},this.dropZones[o]=new b.default(s,o,E),this.dropZones[o].on("elementaligned",function(e){for(var t=e.data,n=0;n<i.draggables.length;n++){var o=i.draggables[n];if(o&&o.elements&&o.elements.length)for(var r=0;r<o.elements.length;r++){var a=o.elements[r];if(a&&a.$[0]===t[0])return void(a.position=g.default.positionToPercentage(i.$container,a.$))}}})}this.on("resize",i.resize,i),this.on("domChanged",function(e){i.contentId===e.data.contentId&&i.trigger("resize")}),this.on("enterFullScreen",function(){i.$container&&(i.$container.parents(".h5p-content").css("height","100%"),i.trigger("resize"))}),this.on("exitFullScreen",function(){i.$container&&(i.$container.parents(".h5p-content").css("height","auto"),i.trigger("resize"))})}var i=n(4),a=o(i),s=n(6),l=o(s),u=n(7),c=o(u),d=n(8),h=o(d),p=n(2),g=o(p),f=n(9),b=o(f),v=n(10),m=o(v),y=H5P.jQuery,k=0;r.prototype=Object.create(H5P.Question.prototype),r.prototype.constructor=r,r.prototype.registerDomElements=function(){var e=this,t="";e.options.question.settings.showTitle&&(t=e.options.question.settings.questionTitle),e.$introduction=y('<p class="h5p-dragquestion-introduction" id="dq-intro-'+k+'">'+t+"</p><p>"+e.options.question.settings.description+"</p>"),e.setIntroduction(e.$introduction);var n="";if(void 0!==this.options.question.settings.background&&(n+="h5p-dragquestion-has-no-background"),"always"===e.options.behaviour.dropZoneHighlighting&&(n&&(n+=" "),n+="h5p-dq-highlight-dz-always"),e.setContent(e.createQuestionContent(),{class:n}),!1!==H5P.canHasFullScreen&&this.options.behaviour.enableFullScreen){var o=function(){H5P.isFullscreen?H5P.exitFullScreen(e.$container):H5P.fullScreen(e.$container.parent().parent(),e)},r=y("<div/>",{class:"h5p-my-fullscreen-button-enter",title:this.options.localize.fullscreen,role:"button",tabindex:0,on:{click:o,keypress:function(e){13!==e.which&&32!==e.which||(o(),e.preventDefault())}},prependTo:this.$container.parent()});this.on("enterFullScreen",function(){r.attr("class","h5p-my-fullscreen-button-exit"),r.attr("title",this.options.localize.exitFullscreen)}),this.on("exitFullScreen",function(){r.attr("class","h5p-my-fullscreen-button-enter"),r.attr("title",this.options.localize.fullscreen)})}e.registerButtons(),setTimeout(function(){e.trigger("resize")},200)},r.prototype.getXAPIData=function(){var e=this.createXAPIEventTemplate("answered");return this.addQuestionToXAPI(e),this.addResponseToXAPI(e),{statement:e.data.statement}},r.prototype.addQuestionToXAPI=function(e){var t=e.getVerifiedStatementValue(["object","definition"]);y.extend(t,this.getXAPIDefinition())},r.prototype.getXAPIDefinition=function(){var e={};e.description={"en-US":y("<div>"+this.options.question.settings.questionTitle+"</div>").text()},e.type="http://adlnet.gov/expapi/activities/cmi.interaction",e.interactionType="matching",e.source=[];for(var t=0;t<this.options.question.task.elements.length;t++){var n=this.options.question.task.elements[t];if(n.dropZones&&n.dropZones.length){var o=n.type.params.alt?n.type.params.alt:n.type.params.text;e.source.push({id:""+t,description:{"en-US":y("<div>"+o+"</div>").text()}})}}e.correctResponsesPattern=[""],e.target=[];var r=!0;for(t=0;t<this.options.question.task.dropZones.length;t++)if(e.target.push({id:""+t,description:{"en-US":y("<div>"+this.options.question.task.dropZones[t].label+"</div>").text()}}),this.options.question.task.dropZones[t].correctElements)for(var i=0;i<this.options.question.task.dropZones[t].correctElements.length;i++)r||(e.correctResponsesPattern[0]+="[,]"),e.correctResponsesPattern[0]+=t+"[.]"+this.options.question.task.dropZones[t].correctElements[i],r=!1;return e},r.prototype.addResponseToXAPI=function(e){var t=this.getMaxScore(),n=this.getScore(),o=n==t;e.setScoredResult(n,t,this,!0,o),e.data.statement.result.response=this.getUserXAPIResponse()},r.prototype.getUserXAPIResponse=function(){var e=this.getUserAnswers();return e?e.filter(function(e){return e.elements.length}).map(function(e,t){return e.elements.filter(function(e){return void 0!==e.dropZone}).map(function(e){return e.dropZone+"[.]"+t}).join("[,]")}).filter(function(e){return void 0!==e&&""!==e}).join("[,]"):""},r.prototype.getUserAnswers=function(){return this.draggables.map(function(e,t){return{index:t,draggable:e}}).filter(function(e){return void 0!==e.draggable&&e.draggable.elements}).map(function(e){return{index:e.index,elements:e.draggable.elements}})},r.prototype.createQuestionContent=function(){var e;this.$container=y('<div class="h5p-inner" role="application" aria-labelledby="dq-intro-'+k+'"></div>'),void 0!==this.options.question.settings.background?this.$container.css("backgroundImage",'url("'+H5P.getPath(this.options.question.settings.background.path,this.id)+'")'):void 0!==this.backgroundColor&&this.$container.css("background-color",this.backgroundColor);var t=this.options.question.task;for(e=0;e<t.elements.length;e++){var n=t.elements[e];if(void 0!==n.dropZones&&0!==n.dropZones.length)this.draggables[e].appendTo(this.$container,this.id);else{var o=this.addElement(n,"static",e);H5P.newRunnable(n.type,this.id,o),0===n.type.library.indexOf("H5P.Image ")&&o.find("img").attr("title",n.type.params.title||"");!function(e,t){setTimeout(function(){g.default.setOpacity(e,"background",t.backgroundOpacity)},0)}(o,n)}}for(this.$noDropZone.appendTo(this.$container),e=0;e<this.dropZones.length;e++)this.dropZones[e].appendTo(this.$container,this.draggables);return this.$container},r.prototype.registerButtons=function(){this.options.behaviour.enableCheckButton&&this.addSolutionButton(),this.addRetryButton(),this.oneDropzonesHasCorrectElement()&&(this.options.behaviour.enableDroppedQuantity||this.addShowSolutionButton(),this.options.behaviour.randomizeDraggables&&this.shuffleDraggables())},r.prototype.addSolutionButton=function(){var e=this;this.addButton("check-answer",this.options.scoreShow,function(){e.answerChecked=!0,e.showAllSolutions(),e.showScore(),e.options.behaviour.enableDroppedQuantity?e.addExplanationDroppedQuantity():e.addExplanation(),y(".h5p-question-explanation").show();var t=e.createXAPIEventTemplate("answered");e.addQuestionToXAPI(t),e.addResponseToXAPI(t),e.trigger(t),e.maxScoreReached&&e.draggables.forEach(function(e){e.multiple&&e.elements.forEach(function(e){e.$.hasClass("h5p-correct")||e.$.addClass("h5p-dragquestion h5p-question-hidden")})}),e.options.behaviour.removeCorrectWrongStyles&&e.maxScoreReached&&e.draggables.forEach(function(e){e.elements.forEach(function(e){e.$.hasClass("h5p-correct")&&e.$.removeClass("h5p-correct"),e.$suffix&&e.$suffix.remove()})}),(e.$introduction?e.$introduction:e.$container.children().first()).focus()})},r.prototype.addExplanation=function(){var e=this,t=this.options.question.task,n=[];t.dropZones.forEach(function(t,o){var r={correct:t.tipsAndFeedback.feedbackOnCorrect,incorrect:t.tipsAndFeedback.feedbackOnIncorrect};if(void 0!==r.correct||void 0!==r.incorrect){var i=t.correctElements,a={};e.draggables.forEach(function(e){e.elements.forEach(function(t){t.dropZone==o&&(a[e.id]={instance:e,correct:-1!==i.indexOf(""+e.id)})})}),Object.keys(a).forEach(function(e){var i=a[e],s=g.default.strip(i.instance.type.params.alt||i.instance.type.params.text)||"?",l=g.default.strip(t.label);i.correct&&r.correct?(n.push({correct:l+" + "+s,text:r.correct}),i.instance.setFeedback(r.correct,o)):!i.correct&&r.incorrect&&(n.push({correct:l+" + ",wrong:s,text:r.incorrect}),i.instance.setFeedback(r.incorrect,o))})}}),0!==n.length&&this.setExplanation(n,this.options.feedbackHeader)},r.prototype.addExplanationDroppedQuantity=function(){var e=this,t=this.options.question.task,n=this,o=[],r=n.dropZones,i=0,r=n.dropZones;t.dropZones.forEach(function(t,n){var a="",s="",l="",u="",c={correct:t.tipsAndFeedback.feedbackOnCorrect,incorrect:t.tipsAndFeedback.feedbackOnIncorrect},d=r[i],h=g.default.strip(t.label),p=0,f=0;e.draggables.forEach(function(e){e.elements.forEach(function(t){t.dropZone==n&&(p++,f+=e.value)})}),void 0!==t.acceptedNumber&&(p==t.acceptedNumber?s=e.options.correctNumber+t.acceptedNumber+"<br />":l=e.options.inCorrectNumber+p+"<br />"),void 0!==t.acceptedValue&&(f==t.acceptedValue?a=e.options.correctValue+t.acceptedValue+"<br />":void 0!==t.acceptedValue&&(u=e.options.inCorrectValue+f+"<br />"));var b="",v=d.getCompletedStatus();1==v?(v="correct",b=c.correct):void 0==t.acceptedNumber&&void 0==t.acceptedValue?v="none":(v="incorrect",b=c.incorrect),"none"!==v&&o.push({correct:h+"<br />"+s+a,wrong:l+u,text:b}),d.markResult(v),i++}),0!==o.length&&this.setExplanation(o,this.options.feedbackHeader)},r.prototype.addExplanationDroppedQuantity00=function(){var e=this,t=this.options.question.task,n=this,o=[],r=n.dropZones,i=0,r=n.dropZones;t.dropZones.forEach(function(t,n){var a={correct:t.tipsAndFeedback.feedbackOnCorrect,incorrect:t.tipsAndFeedback.feedbackOnIncorrect},s=r[i],l=g.default.strip(t.label),u="",c="",d="";void 0!==t.acceptedValue&&(c="Total value ("+t.acceptedValue+")"),void 0!==t.acceptedNumber&&(d="Number ("+t.acceptedNumber+")"),u=d+c;var h=s.getCompletedStatus();if(1==h)o.push({correct:l+" + "+u,text:a.correct});else{var p=0,f=0;e.draggables.forEach(function(e){e.elements.forEach(function(o){o.dropZone==n&&(void 0!==t.acceptedNumber&&p++,void 0!==t.acceptedValue&&(f+=e.value))})});var b="",v="";void 0!==t.acceptedValue&&(b="Wrong total value ("+f+")"),void 0!==t.acceptedNumber&&(v="Wrong number ("+p+")"),u=v+"<br />"+b,o.push({correct:l+" + ",wrong:u,text:a.incorrect})}void 0===t.acceptedNumber&&t.acceptedValue,s.markResult(h),i++}),0!==o.length&&this.setExplanation(o,this.options.feedbackHeader)},r.prototype.addRetryButton=function(){var e=this;this.addButton("try-again",this.options.tryAgain,function(){var t=!1;if(e.solutionViewed){t=!0;e.solutionViewed=!1}e.maxScoreReached&&(t=!0,e.maxScoreReached=!1),e.reTry(t),e.showButton("check-answer"),e.hideButton("try-again"),e.hideButton("show-solution")},!1)},r.prototype.isAnswerSelected=function(){return this.$container.find(".h5p-dropped").length>=this.draggables.length},r.prototype.oneDropzonesHasCorrectElement=function(){for(var e=this.options.question.task,t=0;t<e.dropZones.length;t++)if(0!==e.dropZones[t].correctElements.length)return!0;return!1},r.prototype.addShowSolutionButton=function(){var e=this;this.addButton("show-solution",this.options.showSolutionButton,function(){if(e.options.behaviour.showSolutionsRequiresInput&&!e.isAnswerSelected())return e.updateFeedbackContent(e.options.noInput),e.read(e.options.noInput),void e.hideButton("show-solution");e.showSolution(),e.hideButton("check-answer"),e.hideButton("show-solution"),e.showButton("try-again"),e.read(e.options.displaySolutionDescription)},!1)},r.prototype.addElement=function(e,t,n){return y('<div class="h5p-'+t+'" style="left:'+e.x+"%;top:"+e.y+"%;width:"+e.width+"em;height:"+e.height+'em"></div>').appendTo(this.$container).data("id",n)},r.prototype.resize=function(e){var t=this;if(void 0!==this.$container&&this.$container.is(":visible")){var n=e&&e.data&&e.data.decreaseSize;n||(this.$container.css("height","99999px"),t.$container.parents(".h5p-standalone.h5p-dragquestion").css("width",""));var o=this.options.question.settings.size,r=o.width/o.height,i=this.$container.parent(),a=i.width()-parseFloat(i.css("margin-left"))-parseFloat(i.css("margin-right")),s=t.$container.parents(".h5p-standalone.h5p-dragquestion.h5p-semi-fullscreen");if(s.length){s.css("width",""),n||(t.$container.css("width","10px"),s.css("width",""),setTimeout(function(){t.trigger("resize",{decreaseSize:!0})},200));var l=y(window.frameElement);if(l){a=l.parent().width(),s.css("width",a+"px")}}var u=a/r;a<=0&&(a=o.width,u=o.height),this.$container.css({width:a+"px",height:u+"px",fontSize:a/o.width*16+"px"})}},r.prototype.disableDraggables=function(){this.draggables.forEach(function(e){e.disable()})},r.prototype.enableDraggables=function(){this.draggables.forEach(function(e){e.enable()})},r.prototype.showAllSolutions=function(e){this.points=0,this.rawPoints=0,this.allSolutionsViewed=!0,this.blankIsCorrect&&(this.points=1,this.rawPoints=1);var t;!e&&this.options.behaviour.showScorePoints&&!this.options.behaviour.singlePoint&&this.options.behaviour.applyPenalties&&(t=new H5P.Question.ScorePoints),this.scoreInline=this.options.behaviour.showScoreInline,this.maxScoreReached=!1;for(var n=0;n<this.draggables.length;n++){var o=this.draggables[n];void 0!==o&&(e||o.disable())}if(this.options.behaviour.enableDroppedQuantity)for(var n=0;n<this.dropZones.length;n++){var r=this.dropZones[n];this.points+=r.results(this.draggables,this.correctDraggables,t),this.rawPoints=this.points}else for(var n=0;n<this.draggables.length;n++){var o=this.draggables[n];void 0!==o&&(this.points+=o.results(e,this.correctDZs[n],t,this.scoreInline),this.rawPoints+=o.rawPoints)}this.points<0&&(this.points=0),!this.answered&&this.blankIsCorrect&&(this.points=this.weight),this.options.behaviour.singlePoint&&(this.points=this.points===this.calculateMaxScore()?1:0),e||this.hideButton("check-answer"),this.options.behaviour.enableRetry&&!e&&this.showButton("try-again"),this.options.behaviour.enableSolutionButton&&!e&&this.showButton("show-solution"),this.points===this.getMaxScore()&&(this.maxScoreReached=!0),!this.hasButton("check-answer")||!1!==this.options.behaviour.enableRetry&&this.points!==this.getMaxScore()||this.hideButton("show-solution")},r.prototype.showSolutions=function(){this.solutionViewed||(this.answerChecked||this.showAllSolutions(),this.scoreViewed||this.showScore(),this.showSolution(),this.hideButton("check-answer"),this.hideButton("try-again"))},r.prototype.reTry=function(e,t){var n=this,o=this;if(this.points=0,this.rawPoints=0,this.answered=!1,this.solutionViewed=!1,this.answerChecked=!1,this.scoreViewed=!1,this.draggables.forEach(function(e){e.elements.forEach(function(e){e.$.hasClass("h5p-question-hidden")&&e.$.removeClass("h5p-question-hidden")})}),this.enableDraggables(),o.options.behaviour.randomizeDraggables&&this.shuffleDraggables(),this.options.behaviour.enableDroppedQuantity){var r=0,i=0;this.options.question.task.dropZones.forEach(function(t,a){"none"!==t.status&&i++,"correct"==t.status&&r++;t.acceptedNumber;if(o.options.behaviour.keepCorrectAnswers&&!e)for(var s=0,l=0;l<n.draggables.length;l++){n.draggables[l];"correct"==t.status&&s++}})}if(this.draggables.forEach(function(t){if(o.options.behaviour.keepCorrectAnswers&&!e){var n=(t.id,t.multiple),r=t.elements[0],i="h5p-correct",a=!1;o.options.behaviour.enableDroppedQuantity&&(r.$.hasClass("h5p-correct-quantity")&&(r.$.addClass(i),a=!0),i+="-quantity"),n?t.elements.forEach(function(e){e.$.hasClass(i)&&e.$.hasClass("h5p-dropped")&&(a=!0)}):r.$.hasClass(i)&&(a=!0),a?t.resetPosition(o.correctDZs[t.id],i):t.resetPosition()}else t.resetPosition()}),this.options.behaviour.enableDroppedQuantity&&r==i&&(this.enableDraggables(),this.draggables.forEach(function(e){e.resetPosition()})),this.hasSavedState=!1,this.options.behaviour.enableDroppedQuantity)for(var a=o.dropZones,s=0;s<a.length;s++){var l=a[s],u=l.getCompletedStatus();l.unmarkResult(u,o.options.behaviour.keepCorrectAnswers,o.options.behaviour.disableCompletedDropZones,e)}this.showButton("check-answer"),this.hideButton("try-again"),this.removeFeedback(),this.setExplanation()},r.prototype.showSolution=function(){var e=this;e.solutionViewed=!0;var t=e.dropZones;for(r=0;r<t.length;r++){var n=t[r];n.autoAlign(),n.alignables=[]}for(var o=[],r=0;r<this.draggables.length;r++){var i=this.draggables[r];void 0!==i&&(o[i.id]=this.correctDZs[r])}for(var a=[],s=!1,r=0;r<this.draggables.length;r++){var i=this.draggables[r];if(void 0!==i){if(i.multiple){s=!0;var l=i.id,u=o[l];if(u){a[l]=u.length,i.elements=i.elements.filter(function(e){return void 0!=e});var c=i.elements[0];if(void 0==c.dropZone){var d=i.elements;d.push(d.shift())}for(var h=0;h<i.elements.length;h++){var c=i.elements[h];c.$.hasClass("h5p-correct")&&a[l]--}}}}}if(s)for(var r=0;r<this.draggables.length;r++){var i=this.draggables[r];if(void 0!==i){var l=i.id;if(i.multiple)for(var h=0;h<a[l];h++){var c=i.elements[h];void 0!==c&&c.clone()}}}this.draggables.forEach(function(e){var n=e.id,r=o[n],i=e.multiple;if(i&&r)for(var a=[],s=0;s<r.length;s++)a.push(r[s]);var l=0;e.elements.forEach(function(n){if(n.$suffix&&n.$suffix.remove(),r)if(i&&n.$.hasClass("h5p-wrong")&&n.$.addClass("h5p-dragquestion h5p-question-hidden"),i){if(n.$.hasClass("h5p-correct")){var o=a.indexOf(n.dropZone),s=n.dropZone;u=t[s],-1===u.getIndexOf(n.$)&&u.alignables.push(n.$),u.autoAlign(),a.splice(o,1)}else if(!n.$.hasClass("h5p-wrong")&&!n.$.hasClass("h5p-dropped")){var u=t[a[l]];if(void 0!==u){n.$.addClass("h5p-question-solution"),n.dropZone=u.id;n.$.attr("class");e.updatePlacement(n),n.$.css({left:u.x+"%",top:u.y+"%"}),-1===u.getIndexOf(n.$)&&(u.alignables.push(n.$),u.autoAlign()),n.dropZone="",l++}}}else for(var c=0;c<r.length;c++){n.$.addClass("h5p-question-solution");var u=t[r[c]];void 0!==u&&(e.addToDropZone(0,n,u.id),n.$.css({left:u.x+"%",top:u.y+"%"}),n.$.hasClass("h5p-wrong")&&n.$.addClass("h5p-question-solution"),-1===u.getIndexOf(n.$)&&u.alignables.push(n.$),u.autoAlign())}else n.$.hasClass("h5p-dropped")&&n.$.addClass("h5p-question-hidden")})});for(var r=0;r<this.draggables.length;r++){var i=this.draggables[r];if(void 0!==i)for(var h=0;h<i.elements.length;h++){var c=i.elements[h];c.$.hasClass("h5p-correct")||c.$.hasClass("h5p-question-solution")||c.$.addClass("h5p-question-hidden"),this.options.behaviour.removeCorrectWrongStyles&&c.$.removeClass("h5p-wrong").removeClass("h5p-correct")}}for(var r=0;r<t.length;r++){var n=t[r];n.autoAlign()}this.disableDraggables(),this.showButton("try-again"),this.hideButton("show-solution"),y(".h5p-question-explanation").hide()},r.prototype.resetTask=function(){this.reTry(!0)},r.prototype.calculateMaxScore=function(){var e=0;if(this.blankIsCorrect)return 1;if(this.options.behaviour.enableDroppedQuantity){for(var t=this.options.question.task.dropZones,n=0;n<t.length;n++)void 0===t[n].acceptedNumber&&void 0===t[n].acceptedValue||e++;return e}for(var o=this.options.question.task.elements,n=0;n<o.length;n++){var r=this.correctDZs[n];void 0!==r&&r.length&&(o[n].multiple?e+=r.length:e++)}return e},r.prototype.getMaxScore=function(){this.options.behaviour.singlePoint?this.weight:this.calculateMaxScore();return this.options.behaviour.singlePoint?this.weight:this.calculateMaxScore()},r.prototype.getScore=function(){this.showAllSolutions(!0);var e=this.options.behaviour.applyPenalties||this.options.behaviour.singlePoint||this.options.behaviour.enableDroppedQuantity?this.points:this.rawPoints;return delete this.points,delete this.rawPoints,e},r.prototype.getAnswerGiven=function(){return!this.options.behaviour.showSolutionsRequiresInput||this.answered||this.blankIsCorrect},r.prototype.showScore=function(){var e=this,t=this.calculateMaxScore();if(this.options.behaviour.singlePoint&&(t=1),this.options.behaviour.enableDroppedQuantity){var n=this.options.question.task,o=0,r=0,i=e.dropZones;n.dropZones.forEach(function(e,t){var n=i[o],a=(e.acceptedNumber,n.getCompletedStatus());1==a?(a="correct",e.status=a,r++):(a="wrong",e.status=a),void 0===e.acceptedNumber&&void 0===e.acceptedValue&&(a="none",e.status=a),n.markResult(a),o++});for(var o=0;o<this.draggables.length;o++){var a=this.draggables[o];if(void 0!==a){var s=a.elements[0];this.options.behaviour.enableDroppedQuantity&&(s.$.hasClass("h5p-correct-quantity")?s.$.addClass("h5p-correct"):s.$.hasClass("h5p-incorrect-quantity")&&s.$.addClass("h5p-wrong")),g.default.setOpacity(s.$,"background",a.backgroundOpacity)}}}this.scoreViewed=!0;var l=this.options.behaviour.applyPenalties||this.options.behaviour.singlePoint?this.points:this.rawPoints,u=H5P.Question.determineOverallFeedback(this.options.overallFeedback,l/t).replace("@score",l).replace("@total",t);if(this.options.behaviour.enableDroppedQuantity)var c=!!this.options.behaviour.enableScoreExplanationQuantity&&this.options.scoreExplanationQuantity;else var c=!(!this.options.behaviour.enableScoreExplanation||!this.options.behaviour.applyPenalties)&&this.options.scoreExplanation;this.setFeedback(u,l,t,this.options.scoreBarLabel,c,void 0,this.options.scoreExplanationButtonLabel)},r.prototype.getCurrentState=function(){for(var e={answers:[]},t=0;t<this.draggables.length;t++){var n=this.draggables[t];if(void 0!==n){for(var o=[],r=0;r<n.elements.length;r++){var i=n.elements[r];void 0===i||void 0===i.dropZone||i.$.hasClass("h5p-question-solution")||i.$.hasClass("h5p-question-hidden")||o.push({x:Number(i.position.left.replace("%","")),y:Number(i.position.top.replace("%","")),dz:i.dropZone})}o.length&&(e.answers[t]=o)}}return e},r.prototype.getCopyrights=function(){var e=this,t=new H5P.ContentCopyrights,n=e.options.question.settings.background;if(void 0!==n&&void 0!==n.copyright){var o=new H5P.MediaCopyright(n.copyright);o.setThumbnail(new H5P.Thumbnail(H5P.getPath(n.path,e.id),n.width,n.height)),t.addMedia(o)}for(var r=0;r<e.options.question.task.elements.length;r++){var i=e.options.question.task.elements[r],a=H5P.newRunnable(i.type,e.id);if(void 0!==a.getCopyrights){var s=a.getCopyrights();s.setLabel((i.dropZones.length?"Draggable ":"Static ")+(void 0!==i.type.params.contentName?i.type.params.contentName:"element")),t.addContent(s)}}return t},r.prototype.getTitle=function(){return H5P.createTitle(this.options.question.settings.questionTitle)},r.prototype.shuffleDraggables=function(){var e=[];this.draggables.forEach(function(t){t.elements&&!t.multiple&&e.push([t.x,t.y])}),e=H5P.shuffleArray(e);for(var t=0,n=0;n<this.draggables.length;n++){var o=this.draggables[n];if(void 0===o||o.multiple)t++;else{var r=(o.id,o.elements[0]),i=!0;r.$.hasClass("h5p-dropped")&&(i=!1);var a=e[n-t][0],s=e[n-t][1];o.shufflePosition(i,a,s)}}};var w=function(e,t,n){var o={drag:new a.default([new h.default,new l.default]),drop:new a.default([new h.default,new c.default])};o.drag.useNegativeTabIndex(),o.drop.useNegativeTabIndex();var r,i=function(){r.draggable.trigger("dragend"),r.element.$.removeClass("h5p-draggable-hover"),g.default.setElementOpacity(r.element.$,r.draggable.backgroundOpacity),-1!==o.drop.elements.indexOf(n)&&(o.drop.removeElement(n),n.style.display="none");for(var e=0;e<t.length;e++){var i=t[e];i.dehighlight(),-1!==o.drop.elements.indexOf(i.$dropZone[0])&&o.drop.removeElement(i.$dropZone[0])}if(r.element.$.is(":visible"))r.element.$.focus();else{var a=r.draggable.elements[r.draggable.elements.length-1].$;o.drag.setTabbable(a[0]),a.focus()}r=void 0};return o.drag.on("select",function(a){var s=g.default.elementToDraggable(e,a.element);if(r)return void i();r=s,r.element.$.addClass("h5p-draggable-hover"),g.default.setElementOpacity(r.element.$,r.draggable.backgroundOpacity),r.draggable.trigger("dragstart",r.draggable.mustCopyElement(r.element)?"copy":"move"),o.drop.addElement(n),n.style.display="block",n.style.left=r.draggable.x+"%",n.style.top=r.draggable.y+"%",n.style.width=r.draggable.width+"em",n.style.height=r.draggable.height+"em";for(var l,u=0;u<t.length;u++){var c=t[u];c.accepts(r.draggable,e)&&(c.highlight(),o.drop.addElement(c.$dropZone[0]),l&&r.element.dropZone!==c.id||(l=c.$dropZone))}l&&(o.drop.setTabbable(l[0]),l.focus())}),o.drop.on("select",function(o){if(r){if(o.element===n)return void 0!==r.element.dropZone&&r.element.reset(),r.draggable.multiple||(r.element.$.css({left:r.draggable.x+"%",top:r.draggable.y+"%",width:r.draggable.width+"em",height:r.draggable.height+"em"}),r.draggable.updatePlacement(r.element)),r.element.$[0].setAttribute("aria-grabbed","false"),void i();var a=g.default.elementToDropZone(t,o.element);if(r.draggable.mustCopyElement(r.element)&&r.element.clone(),a.resetSingleDraggables&&a.single)for(var s=0;s<e.length;s++)if(e[s]&&e[s].isInDropZone(a.id)){var l=e[s],u=l.multiple;u||l.resetPosition()}else;r.draggable.addToDropZone(r.index,r.element,a.id),r.element.$.css({left:a.x+"%",top:a.y+"%"}),-1===a.getIndexOf(r.element.$)&&a.alignables.push(r.element.$),a.autoAlign(),r.element.$[0].setAttribute("aria-grabbed","false"),i()}}),o};H5P.DragQuestionPapiJo=r},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=n(1),s=n(0),l=n(5),u=(0,a.removeAttribute)("tabindex"),c=((0,s.forEach)(u),(0,a.setAttribute)("tabindex","0")),d=(0,a.setAttribute)("tabindex","-1"),h=(0,a.hasAttribute)("tabindex"),p=function(){function e(t){o(this,e),r(this,(0,l.Eventful)()),this.plugins=t||[],this.elements=[],this.negativeTabIndexAllowed=!1,this.on("nextElement",this.nextElement,this),this.on("previousElement",this.previousElement,this),this.initPlugins()}return i(e,[{key:"addElement",value:function(e){this.elements.push(e),this.firesEvent("addElement",e),1===this.elements.length&&this.setTabbable(e)}},{key:"removeElement",value:function(e){this.elements=(0,s.without)([e],this.elements),h(e)&&(this.setUntabbable(e),this.elements[0]&&this.setTabbable(this.elements[0])),this.firesEvent("removeElement",e)}},{key:"firesEvent",value:function(e,t){var n=this.elements.indexOf(t);return this.fire(e,{element:t,index:n,elements:this.elements,oldElement:this.tabbableElement})}},{key:"nextElement",value:function(e){var t=e.index,n=t===this.elements.length-1,o=this.elements[n?0:t+1];this.setTabbable(o),o.focus()}},{key:"setTabbable",value:function(e){(0,s.forEach)(this.setUntabbable.bind(this),this.elements),c(e),this.tabbableElement=e}},{key:"setUntabbable",value:function(e){this.negativeTabIndexAllowed?d(e):u(e)}},{key:"previousElement",value:function(e){var t=e.index,n=0===t,o=this.elements[n?this.elements.length-1:t-1];this.setTabbable(o),o.focus()}},{key:"useNegativeTabIndex",value:function(){this.negativeTabIndexAllowed=!0,this.elements.forEach(function(e){e.hasAttribute("tabindex")||d(e)})}},{key:"initPlugins",value:function(){this.plugins.forEach(function(e){void 0!==e.init&&e.init(this)},this)}}]),e}();t.default=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Eventful=function(){return{listeners:{},on:function(e,t,n){var o={listener:t,scope:n};return this.listeners[e]=this.listeners[e]||[],this.listeners[e].push(o),this},fire:function(e,t){return(this.listeners[e]||[]).every(function(e){return!1!==e.listener.call(e.scope||this,t)})},propagate:function(e,t){var n=this;e.forEach(function(e){return t.on(e,function(t){return n.fire(e,t)})})}}}},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(1),a=n(0),s=(0,i.setAttribute)("aria-grabbed"),l=(0,i.attributeEquals)("aria-grabbed","true"),u=(0,a.filter)((0,i.hasAttribute)("aria-grabbed")),c=(0,a.compose)((0,a.forEach)((0,i.setAttribute)("aria-grabbed","false")),u),d=(0,a.compose)((0,a.some)(l),u),h=function(){function e(){o(this,e)}return r(e,[{key:"init",value:function(e){this.controls=e,this.controls.on("select",this.select,this)}},{key:"addElement",value:function(e){s("false",e),this.controls.addElement(e)}},{key:"setAllGrabbedToFalse",value:function(){c(this.controls.elements)}},{key:"hasAnyGrabbed",value:function(){return d(this.controls.elements)}},{key:"select",value:function(e){var t=e.element,n=l(t);this.setAllGrabbedToFalse(),n||s("true",t)}}]),e}();t.default=h},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(1),a=n(0),s=(0,i.setAttribute)("aria-dropeffect","none"),l=(0,i.setAttribute)("aria-dropeffect","move"),u=(0,a.filter)((0,i.hasAttribute)("aria-dropeffect")),c=(0,a.compose)((0,a.forEach)(l),u),d=(0,a.compose)((0,a.forEach)(s),u),h=function(){function e(){o(this,e)}return r(e,[{key:"init",value:function(e){this.controls=e}},{key:"setAllToMove",value:function(){c(this.controls.elements)}},{key:"setAllToNone",value:function(){d(this.controls.elements)}}]),e}();t.default=h,h.DropEffect={COPY:"copy",MOVE:"move",EXECUTE:"execute",POPUP:"popup",NONE:"none"}},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=function(){function e(){o(this,e),this.selectability=!0}return r(e,[{key:"init",value:function(e){this.boundHandleKeyDown=this.handleKeyDown.bind(this),this.controls=e,this.controls.on("addElement",this.listenForKeyDown,this),this.controls.on("removeElement",this.removeKeyDownListener,this)}},{key:"listenForKeyDown",value:function(e){e.element.addEventListener("keydown",this.boundHandleKeyDown)}},{key:"removeKeyDownListener",value:function(e){e.element.removeEventListener("keydown",this.boundHandleKeyDown)}},{key:"handleKeyDown",value:function(e){switch(e.which){case 13:case 32:this.select(e.target),e.preventDefault();break;case 37:case 38:this.hasChromevoxModifiers(e)||(this.previousElement(e.target),e.preventDefault());break;case 39:case 40:this.hasChromevoxModifiers(e)||(this.nextElement(e.target),e.preventDefault())}}},{key:"hasChromevoxModifiers",value:function(e){return e.shiftKey||e.ctrlKey}},{key:"previousElement",value:function(e){this.controls.firesEvent("previousElement",e)}},{key:"nextElement",value:function(e){this.controls.firesEvent("nextElement",e)}},{key:"select",value:function(e){this.selectability&&!1!==this.controls.firesEvent("before-select",e)&&(this.controls.firesEvent("select",e),this.controls.firesEvent("after-select",e))}},{key:"disableSelectability",value:function(){this.selectability=!1}},{key:"enableSelectability",value:function(){this.selectability=!0}}]),e}();t.default=i},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(2),a=function(e){return e&&e.__esModule?e:{default:e}}(i),s=H5P.jQuery,l=function(){function e(t,n,r){o(this,e);var i=this;H5P.EventDispatcher.call(i),i.id=n,i.showLabel=t.showLabel,i.label=t.label,i.x=t.x,i.y=t.y,i.width=t.width,i.height=t.height,i.backgroundOpacity=t.backgroundOpacity,i.tip=t.tipsAndFeedback.tip||"",i.single=t.single,i.acceptedNumber=t.acceptedNumber,i.acceptedValue=t.acceptedValue,i.autoAlignable=t.autoAlign,i.alignables=[],i.l10n=r,i.dropzonebordercolor=t.bordercolor,i.background=t.background,i.resetSingleDraggables=t.resetSingleDraggables}return r(e,[{key:"appendTo",value:function(e,t){var n=this,o='<div class="h5p-inner" style="color:'+n.dropzonebordercolor+';"></div>',r="";n.showLabel&&(o='<div class="h5p-label">'+n.label+'<span class="h5p-hidden-read"></span></div>'+o,r=" h5p-has-label"),o='<span class="h5p-hidden-read">'+n.l10n.prefix.replace("{num}",n.id+1)+"</span>"+o;var i=n.backgroundOpacity/100,l=n.background;l=a.default.setAlphas(l,"rgba(",i),l=a.default.setAlphas(l,"rgb(",i),n.$dropZone=s("<div/>",{class:"h5p-dropzone"+r,tabindex:"-1",title:n.showLabel?s("<div/>",{html:n.label}).text():null,role:"button","aria-disabled":!0,css:{left:n.x+"%",top:n.y+"%",width:n.width+"em",height:n.height+"em",background:l},html:o}).appendTo(e).children(".h5p-inner").droppable({activeClass:"h5p-active",tolerance:"intersect",accept:function(e){var o=a.default.elementToDraggable(t,e);return!!o&&n.accepts(o.draggable,t)},drop:function(e,o){var r=s(this);if(n.single)for(var i=0;i<t.length;i++)if(t[i]&&t[i].isInDropZone(n.id)){var l=t[i],u=l.multiple;u||l.resetPosition()}else;var c=n.backgroundOpacity/100,d=n.background;d=a.default.setAlphas(d,"rgba(",c),d=a.default.setAlphas(d,"rgb(",c),r.css({backgroundColor:d}),o.draggable.data("addToZone",n.id),-1===n.getIndexOf(o.draggable)&&n.alignables.push(o.draggable),n.autoAlignable.enabled&&n.autoAlign()},over:function(){a.default.setOpacity(s(this).addClass("h5p-over"),"background",n.backgroundOpacity)},out:function(){a.default.setOpacity(s(this).removeClass("h5p-over"),"background",n.backgroundOpacity)}}).end().focus(function(){u instanceof H5P.jQuery&&u.attr("tabindex","0")}).blur(function(){u instanceof H5P.jQuery&&u.attr("tabindex","-1")});var u=H5P.JoubelUI.createTip(n.tip,{tipLabel:n.l10n.tipLabel,tabcontrol:!0});u instanceof H5P.jQuery&&s("<span/>",{class:"h5p-dq-tipwrap","aria-label":n.l10n.tipAvailable,append:u,appendTo:n.$dropZone}),t.forEach(function(e){var t=e.element.$;e.isInDropZone(n.id)&&-1===n.getIndexOf(t)&&n.alignables.push(t)}),n.autoAlignable.enabled&&n.autoAlign(),setTimeout(function(){n.updateBackgroundOpacity()},0)}},{key:"updateBackgroundOpacity",value:function(){a.default.setOpacity(this.$dropZone.children(".h5p-label"),"background",this.backgroundOpacity),a.default.setOpacity(this.$dropZone.children(".h5p-inner"),"background",this.backgroundOpacity)}},{key:"accepts",value:function(e,t){var n=this;if(!e.hasDropZone(n.id))return!1;if(n.single)for(var o=0;o<t.length;o++)if(t[o]&&t[o].isInDropZone(n.id)){var r=t[o],i=!1;if(r.elements.forEach(function(e){e.$.hasClass("h5p-correct")&&(i=!0)}),!n.resetSingleDraggables||r.multiple||i||e.id==r.id)return!1}return!0}},{key:"getIndexOf",value:function(e){for(var t=this,n=0;n<t.alignables.length;n++)if(t.alignables[n][0]===e[0])return n;return-1}},{key:"removeAlignable",value:function(e){var t=this,n=t.getIndexOf(e);-1!==n&&(t.alignables.splice(n,1),void 0===t.autoAlignTimer&&t.autoAlignable.enabled&&(t.autoAlignTimer=setTimeout(function(){delete t.autoAlignTimer,t.autoAlign()},1)))}},{key:"autoAlign",value:function(){for(var e,t,n=this,o=n.$dropZone.parent()[0].getBoundingClientRect(),r={x:n.autoAlignable.spacing/n.autoAlignable.size.width*100,y:n.autoAlignable.spacing/n.autoAlignable.size.height*100},i={x:n.x+r.x,y:n.y+r.y},a=n.$dropZone[0].getBoundingClientRect(),s={x:a.width-2*r.x,y:a.height-2*r.y},l={x:s.x,y:s.y},u=0,c=function(){e.css({left:i.x+"%",top:i.y+"%"}),n.trigger("elementaligned",e);var r=t.width+n.autoAlignable.spacing;l.x-=r,i.x+=r/o.width*100;var a=t.height+n.autoAlignable.spacing;a>u&&(u=a)},d=0;d<n.alignables.length;d++)if(e=n.alignables[d],t=e[0].getBoundingClientRect(),l.x>=t.width)c();else{if(l.x=s.x,i.x=n.x+r.x,u&&(l.y-=u,i.y+=u/o.height*100,u=0),l.y<=0)return;c()}}},{key:"highlight",value:function(){this.$dropZone.attr("aria-disabled","false").children(".h5p-inner").addClass("h5p-active")}},{key:"dehighlight",value:function(){this.$dropZone.attr("aria-disabled","true").children(".h5p-inner").removeClass("h5p-active")}},{key:"markResult",value:function(e){this.$dropZone.children(".h5p-inner").addClass("h5p-dropzone-"+e+"-answer")}},{key:"unmarkResult",value:function(e,t,n,o){0==e?(this.$dropZone.children(".h5p-inner").removeClass("h5p-dropzone-wrong-answer"),this.$dropZone.removeClass("h5p-dropzone-completed-answer")):t&&n?this.$dropZone.children(".h5p-inner").droppable("option","disabled",!0):this.$dropZone.children(".h5p-inner").removeClass("h5p-dropzone-correct-answer"),o&&(this.$dropZone.children(".h5p-inner").removeClass("h5p-dropzone-correct-answer h5p-dropzone-wrong-answer"),this.$dropZone.children(".h5p-inner").droppable("option","disabled",!1),this.$dropZone.removeClass("h5p-dropzone-completed-answer"))}},{key:"markCompleted",value:function(){this.$dropZone.addClass("h5p-dropzone-completed-answer")}},{key:"unMarkCompleted",value:function(){this.$dropZone.removeClass("h5p-dropzone-completed-answer")}},{key:"getCompletedStatus",value:function(){return this.$dropZone.hasClass("h5p-dropzone-completed-answer")}},{key:"results",value:function(e,t,n){for(var o=this,r=0,i=0,a=0,l=!1,u=o.acceptedNumber,c=o.acceptedValue,d=o.id,t=t[d],h=!1,p=!1,g=0;g<e.length;g++){var f=e[g];if(void 0!==f){var b=f.elements[0];if(b.dropZone===d){r++;var v=f.id,m=f.value,y=s.inArray(v,t),h=!1;i>u||(-1!==y&&(i++,a+=m),void 0==u&&a==c&&(h=!0),void 0===c&&i==u&&(p=!0),-1===y||i!=u&&!h||a!==c&&!p?(l=!1,o.unMarkCompleted()):(l=!0,o.markCompleted()))}}}for(var g=0;g<e.length;g++){var f=e[g];if(void 0!==f){var b=f.elements[0];b.dropZone===d?(b.$.removeClass("h5p-correct-quantity h5p-incorrect-quantity"),1==l?b.$.addClass("h5p-correct-quantity"):0==l&&b.$.addClass("h5p-incorrect-quantity")):void 0===b.dropZone&&b.$.removeClass("h5p-correct-quantity h5p-incorrect-quantity")}}return void 0===l&&o.unmarkResult(),!0===l?1:0}}]),e}();t.default=l},function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=n(2),l=function(e){return e&&e.__esModule?e:{default:e}}(s),u=H5P.jQuery,c=function(e){function t(e,n,i,a){o(this,t);var s=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),l=s;if(l.$=u(l),l.id=n,l.elements=[],l.x=e.x,l.y=e.y,l.width=e.width,l.height=e.height,l.backgroundOpacity=e.backgroundOpacity,l.dropZones=e.dropZones,l.type=e.type,l.multiple=e.multiple,l.value=e.value,l.l10n=a,l.inline=e.inline,i){l.multiple&&l.elements.push({});for(var c=0;c<i.length;c++)l.elements.push({dropZone:i[c].dz,position:{left:i[c].x+"%",top:i[c].y+"%"}})}return s}return i(t,e),a(t,[{key:"appendTo",value:function(e,t){var n=this;if(n.elements.length)for(var o=0;o<n.elements.length;o++)n.attachElement(o,e,t);else n.attachElement(null,e,t)}},{key:"attachElement",value:function(e,t,n){var o,r=this;null===e?(o={},r.elements.push(o),e=r.elements.length-1):o=r.elements[e],u.extend(o,{clone:function(){r.attachElement(null,t,n)},reset:function(){void 0!==o.dropZone&&(r.trigger("leavingDropZone",o),delete o.dropZone),r.multiple&&(o.$.remove(),delete r.elements[e],r.trigger("elementremove",o.$[0])),delete o.position}}),o.$=u("<div/>",{class:"h5p-draggable",tabindex:"-1",role:"button",css:{left:r.x+"%",top:r.y+"%",width:r.width+"em",height:r.height+"em"},appendTo:t,title:r.type.params.title}).on("click",function(){r.trigger("focus",this)}).draggable({revert:function(e){t.removeClass("h5p-dragging");var n=u(this);return n.data("uiDraggable").originalPosition={top:r.y+"%",left:r.x+"%"},r.updatePlacement(o),n[0].setAttribute("aria-grabbed","false"),r.trigger("dragend"),!e},start:function(){var e=u(this),n=r.mustCopyElement(o);n&&o.clone(),e.removeClass("h5p-wrong").detach().appendTo(t),t.addClass("h5p-dragging"),l.default.setElementOpacity(e,r.backgroundOpacity),this.setAttribute("aria-grabbed","true"),r.trigger("focus",this),r.trigger("dragstart",{element:this,effect:n?"copy":"move"})},stop:function(){var n=u(this);o.position=l.default.positionToPercentage(t,n),n.css(o.position);var i=n.data("addToZone");void 0!==i?(n.removeData("addToZone"),r.addToDropZone(e,o,i)):o.reset()}}).css("position",""),r.element=o,o.position&&(o.$.css(o.position),r.updatePlacement(o)),l.default.addHover(o.$,r.backgroundOpacity),H5P.newRunnable(r.type,n,o.$),0===r.type.library.indexOf("H5P.Image ")&&o.$.find("img").attr("title",r.type.params.title||""),u('<span class="h5p-hidden-read">'+r.l10n.prefix.replace("{num}",r.id+1)+"</span>").prependTo(o.$),u('<span class="h5p-hidden-read"></span>').appendTo(o.$),setTimeout(function(){l.default.setElementOpacity(o.$,r.backgroundOpacity)},0),r.trigger("elementadd",o.$[0])}},{key:"setFeedback",value:function(e,t){this.elements.forEach(function(n){n.dropZone===t&&(void 0===n.$feedback&&(n.$feedback=u("<span>",{class:"h5p-hidden-read",appendTo:n.$})),n.$feedback.html(e))})}},{key:"mustCopyElement",value:function(e){return this.multiple&&void 0===e.dropZone}},{key:"hasDropZone",value:function(e){for(var t=this,n=0;n<t.dropZones.length;n++)if(parseInt(t.dropZones[n])===e)return!0;return!1}},{key:"addToDropZone",value:function(e,t,n){var o=this;if(o.multiple)for(var r=0;r<o.elements.length;r++)if(r!==e&&void 0!==o.elements[r]&&o.elements[r].dropZone===n)return void 0!==o.elements[e].dropZone&&o.elements[e].dropZone!==n&&o.trigger("leavingDropZone",t),t.$.remove(),delete o.elements[e],void o.trigger("elementremove",o.element.$[0]);void 0!==t.dropZone&&t.dropZone!==n&&o.trigger("leavingDropZone",t),t.dropZone=n,o.updatePlacement(t),o.trigger("interacted")}},{key:"updatePlacement",value:function(e){var t=this;e.$suffix&&e.$suffix.remove(),void 0!==e.dropZone?(e.$.addClass("h5p-dropped"),l.default.setElementOpacity(e.$,t.backgroundOpacity),e.$suffix=u('<span class="h5p-hidden-read">'+this.l10n.suffix.replace("{num}",e.dropZone+1)+". </span>").appendTo(e.$)):(e.$.removeClass("h5p-dropped").removeClass("h5p-wrong").removeClass("h5p-correct").removeClass("h5p-question-solution").css({border:"",background:""}),l.default.setElementOpacity(e.$,this.backgroundOpacity))}},{key:"resetPosition",value:function(e,t){var n=this,o=!1,r=void 0!==e;this.elements.forEach(function(i){if(i.$feedback&&(i.$feedback.remove(),delete i.$feedback),void 0!==i.dropZone){var a=n.elements[n.elements.indexOf(i)],s=a.$.hasClass(t);if(r&&-1!==u.inArray(i.dropZone,e)&&!0===s){o=!0;var a=n.elements[n.elements.indexOf(i)];return void a.$.draggable("disable")}var a=i.$;a.animate({left:n.x+"%",top:n.y+"%"},function(){n.multiple&&(void 0!==a.dropZone&&n.trigger("leavingDropZone",a),a.remove(),n.elements.indexOf(i)>=0&&delete n.elements[n.elements.indexOf(i)],n.trigger("elementremove",a[0]))}),n.updatePlacement(i)}}),!1===o&&(void 0!==n.element.dropZone&&(n.trigger("leavingDropZone",n.element),delete n.element.dropZone),n.updatePlacement(n.element))}},{key:"shufflePosition",value:function(e,t,n){this.x=t,this.y=n;var o=this;e&&this.elements.forEach(function(e){e.$.animate({left:o.x+"%",top:o.y+"%"},function(){})})}},{key:"findElement",value:function(e){for(var t=this,n=0;n<t.elements.length;n++)if(void 0!==t.elements[n]&&t.elements[n].$.is(e))return{element:t.elements[n],index:n}}},{key:"isInDropZone",value:function(e){for(var t=this,n=0;n<t.elements.length;n++)if(void 0!==t.elements[n]&&t.elements[n].dropZone===e)return!0;return!1}},{key:"disable",value:function(){for(var e=this,t=0;t<e.elements.length;t++){var n=e.elements[t];n&&(n.$.draggable("disable"),e.trigger("elementremove",n.$[0]))}}},{key:"enable",value:function(){for(var e=this,t=0;t<e.elements.length;t++){var n=e.elements[t];n&&(n.$.draggable("enable"),e.trigger("elementadd",n.$[0]))}}},{key:"results",value:function(e,t,n,o){var r,i,a,s,l=this,u=0;if(l.rawPoints=0,void 0===t){for(r=0;r<l.elements.length;r++)void 0!==(a=l.elements[r])&&void 0!==a.dropZone&&(!0!==e&&l.markElement(a,"wrong",n,o),u--);return u}for(r=0;r<l.elements.length;r++)if(void 0!==(a=l.elements[r])&&void 0!==a.dropZone){for(s=!1,i=0;i<t.length;i++)if(a.dropZone===t[i]){!0!==e&&1==a.$suffix.length&&l.markElement(a,"correct",n,o),a.$.hasClass("h5p-question-solution")||(l.rawPoints++,u++),s=!0;break}s||(!0!==e&&l.markElement(a,"wrong",n,o),a.$.hasClass("h5p-question-solution")||u--)}return u}},{key:"markElement",value:function(e,t,n,o){var r=u("<span/>",{class:"h5p-hidden-read",html:this.l10n[t+"Answer"]});n&&(r=r.add(n.getElement("correct"===t))),e.$suffix=e.$suffix.add(r),!0===o?(e.$suffix.addClass("h5p-question-score-inline"),e.$.addClass("h5p-"+t+" h5p-dg-inline").append(r)):(e.$suffix.addClass("h5p-question-score-normal"),e.$.addClass("h5p-"+t+" h5p-dg-normal").append(r)),l.default.setElementOpacity(e.$,this.backgroundOpacity)}},{key:"markElementCorrectNumber",value:function(e){e.$.addClass("h5p-correct h5p-dg-normal")}},{key:"unmarkElementCorrectNumber",value:function(e){e.$.removeClass("h5p-correct h5p-dg-normal")}}]),t}(H5P.EventDispatcher);t.default=c}]);